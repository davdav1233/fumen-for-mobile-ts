(()=>{"use strict";var e={7210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PageEnv=void 0,t.PageEnv={Version:"dev-2021-06-08T02:41:30.740Z",Debug:JSON.parse("true")}},5917:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.main=t.actions=void 0;const n=o(655),i=o(6314),r=o(6085),s=o(6540),a=o(1639),c=n.__importDefault(o(2181)),d=n.__importDefault(o(6071)),l=o(1307),u=o(7486),m=o(7210),p=o(6886),g=o(8456),h=o(5597),f=o(7270),y=o(2265),v=o(9986),x=o(9632),P=o(2281),b=o(9673),k=o(7587),w=o(9164),C=o(4257),T=o(4848),S=o(6266);t.actions={...g.animationActions,...h.modeActions,...f.modalActions,...y.pageActions,...v.setterActions,...x.utilsActions,...P.mementoActions,...p.fieldEditorActions,...b.commentActions,...k.convertActions,...w.userSettingsActions},t.main=((e=!1)=>e?a.withLogger(s.app)(i.initState,t.actions,r.view,document.body):s.app(i.initState,t.actions,r.view,document.body))(m.PageEnv.Debug),window.onresize=()=>{t.main.resize({width:window.document.body.clientWidth,height:window.document.body.clientHeight})},window.addEventListener("load",(()=>{const e=T.getURLQuery();z(e),F(e),I()}));const z=e=>{const o=new d.default(null,{order:["myQueryDetector","querystring","navigator","path","subdomain"],cookieMinutes:0});o.addDetector({name:"myQueryDetector",lookup:()=>e.get("lng"),cacheUserLanguage(){}}),c.default.use(o).init({fallbackLng:"en",resources:{en:{translation:u.resources},ja:{translation:l.resources}}}).then((()=>{t.main.refresh()})).catch((()=>{console.error("Failed to load i18n")}))},F=e=>{{const o=e.get("d");if(void 0!==o)return t.main.loadFumen({fumen:o})}{const e=S.localStorageWrapper.loadFumen();if(e)return M.toast({html:C.i18n.Top.RestoreFromStorage(),classes:"top-toast",displayLength:1500}),t.main.loadFumen({fumen:e})}return t.main.loadNewFumen()},I=()=>{let e=!1;const o=S.localStorageWrapper.loadUserSettings();void 0!==o.ghostVisible&&(t.main.changeGhostVisible({visible:o.ghostVisible}),e=!0),void 0!==o.loop&&(t.main.changeLoop({enable:o.loop}),e=!0),e&&t.main.reopenCurrentPage()};"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("./sw.js").then((e=>{console.log("SW registered: ",e)})).catch((e=>{console.error("SW registration failed: ",e)}))}))},8456:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.animationActions=void 0;const n=o(9609),i=o(5917),r=o(9774);t.animationActions={startAnimation:()=>e=>n.sequence(e,[t.animationActions.pauseAnimation(),()=>({play:{...e.play,status:r.AnimationState.Play},handlers:{animation:setInterval((()=>{i.main.nextLoopPage()}),e.play.intervalTime)}})]),pauseAnimation:()=>e=>{if(void 0!==e.handlers.animation)return clearInterval(e.handlers.animation),{play:{...e.play,status:r.AnimationState.Pause},handlers:{animation:void 0}}}}},9673:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commentActions=void 0;const n=o(9609),i=o(5917),r=o(6314),s=o(4826),a=o(2995),c=o(1983);t.commentActions={updateCommentText:({text:e,pageIndex:t})=>o=>{if(o.fumen.currentIndex!==t)return r.resources.comment=void 0,n.sequence(o,[d(t,void 0!==e?e:""),i.actions.reopenCurrentPage()]);let s=!1;return void 0!==e&&(s=void 0===r.resources.comment,r.resources.comment={pageIndex:t,text:e}),s?{}:void 0},commitCommentText:()=>e=>{if(void 0===r.resources.comment)return;const{text:t,pageIndex:o}=r.resources.comment;return r.resources.comment=void 0,n.sequence(e,[i.actions.setCommentText({text:t,pageIndex:o})])},setCommentText:({text:e,pageIndex:t})=>o=>n.sequence(o,[d(t,e),i.actions.reopenCurrentPage()]),resetCommentText:({pageIndex:e})=>t=>n.sequence(t,[p(e),i.actions.reopenCurrentPage()])};const d=(e,t)=>o=>{const n=o.fumen.pages[e];if(void 0!==n&&n.comment.text!==t)return s.Quiz.isQuizComment(t)?u(e,t)(o):m(e,t)(o)},l=(e,t)=>{let o;for(let n=t;n<e.length;n+=1)void 0!==e[n].comment.text&&(o=n);return o},u=(e,t)=>o=>{let r=o.fumen.pages;const s=new c.Pages(r),d=r[e],u=l(r,e+1),m=void 0!==r[e-1]?s.getComment(e-1):void 0,p=[];if(void 0!==m&&c.isQuizCommentResult(m)&&m.quizAfterOperation.format().toString()===t){if(void 0!==d.comment.text){const t=d.comment.text;s.unfreezeComment(e),p.push(a.toUnfreezeCommentTask(e,t))}r=s.pages}else{void 0===d.comment.text&&(s.freezeComment(e),p.push(a.toFreezeCommentTask(e))),d.flags.quiz||(s.setQuizFlag(e),p.push(a.toSetQuizFlagTask(e))),r=s.pages;const o=r[e],n=a.toPrimitivePage(o);o.comment={text:t},p.push(a.toSinglePageTask(e,n,o))}if(void 0!==u&&void 0!==r[u]){const e=s.getComment(u-1);if(c.isQuizCommentResult(e)){const t=e.quizAfterOperation.format().toString(),o=r[u];if(void 0!==o.comment.text&&o.comment.text===t){const e=o.comment.text;s.unfreezeComment(u),p.push(a.toUnfreezeCommentTask(u,e))}}}return n.sequence(o,[()=>({fumen:{...o.fumen,pages:r}}),i.actions.registerHistoryTask({task:a.toPageTaskStack(p,e)})])},m=(e,t)=>o=>{let r=o.fumen.pages;const s=new c.Pages(r),d=r[e],u=l(r,e+1),m=void 0!==r[e-1]?s.getComment(e-1):void 0,p=[];if(void 0!==m&&c.isTextCommentResult(m)&&m.text===t){if(void 0!==d.comment.text){const t=d.comment.text;s.unfreezeComment(e),p.push(a.toUnfreezeCommentTask(e,t))}r=s.pages}else{void 0===d.comment.text&&(s.freezeComment(e),p.push(a.toFreezeCommentTask(e))),d.flags.quiz&&(s.unsetQuizFlag(e),p.push(a.toUnsetQuizFlagTask(e))),r=s.pages;const o=r[e],n=a.toPrimitivePage(o);o.comment={text:t},p.push(a.toSinglePageTask(e,n,o))}if(void 0!==u&&void 0!==r[u]){const e=r[u];if(void 0!==e.comment.text&&e.comment.text===t){const t=e.comment.text;s.unfreezeComment(u),p.push(a.toUnfreezeCommentTask(u,t))}}return n.sequence(o,[()=>({fumen:{...o.fumen,pages:r}}),i.actions.registerHistoryTask({task:a.toPageTaskStack(p,e)})])},p=e=>t=>{const o=t.fumen.pages,r=new c.Pages(o),s=o[e],d=[];if(e<=0)return;if(void 0===s.comment.text)return;const l=s.comment.text;return r.unfreezeComment(e),d.push(a.toUnfreezeCommentTask(e,l)),n.sequence(t,[()=>({fumen:{...t.fumen,pages:o}}),i.actions.registerHistoryTask({task:a.toPageTaskStack(d,e)})])}},9609:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sequence=void 0,t.sequence=function(e,t){let o=e,n={};for(const i of t){if(void 0===i)continue;const t=i(o);n={...n,...t},o={...e,...n}}return n}},7587:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertToGoalField=t.convertActions=void 0;const n=o(9609),i=o(5917),r=o(2995),s=o(1983),a=o(9774),c=o(8711),d=o(9782);t.convertActions={shiftToLeft:()=>e=>{const t=e.fumen.currentIndex,o=e.fumen.pages,a=new s.Pages(o),d=o[t],l=r.toPrimitivePage(d),u=a.getField(t,s.PageFieldOperation.Command),m=u.copy();u.shiftToLeft();const p=d.piece;if(void 0===p&&m.equals(u))return;const g=a.getField(t,s.PageFieldOperation.None);if(d.commands=s.parseToCommands(g,u),void 0!==p){const e=c.getBlockPositions(p.type,p.rotation,p.coordinate.x,p.coordinate.y);Math.min(...e.map((e=>e[0])))<1?d.piece=void 0:p.coordinate.x-=1}return n.sequence(e,[i.actions.registerHistoryTask({task:r.toSinglePageTask(t,l,d)}),()=>({fumen:{...e.fumen,pages:o}}),i.actions.reopenCurrentPage()])},shiftToRight:()=>e=>{const t=e.fumen.currentIndex,o=e.fumen.pages,a=new s.Pages(o),d=o[t],l=r.toPrimitivePage(d),u=a.getField(t,s.PageFieldOperation.Command),m=u.copy();u.shiftToRight();const p=d.piece;if(void 0===p&&m.equals(u))return;const g=a.getField(t,s.PageFieldOperation.None);if(d.commands=s.parseToCommands(g,u),void 0!==p){const e=c.getBlockPositions(p.type,p.rotation,p.coordinate.x,p.coordinate.y);8<Math.max(...e.map((e=>e[0])))?d.piece=void 0:p.coordinate.x+=1}return n.sequence(e,[i.actions.registerHistoryTask({task:r.toSinglePageTask(t,l,d)}),()=>({fumen:{...e.fumen,pages:o}}),i.actions.reopenCurrentPage()])},shiftToUp:()=>e=>{const t=e.fumen.currentIndex,o=e.fumen.pages,d=new s.Pages(o),l=o[t],u=r.toPrimitivePage(l),m=d.getField(t,s.PageFieldOperation.Command),p=m.copy();m.shiftToUp();const g=l.piece;if(void 0===g&&p.equals(m))return;const h=d.getField(t,s.PageFieldOperation.None);if(l.commands=s.parseToCommands(h,m),void 0!==g){const e=c.getBlockPositions(g.type,g.rotation,g.coordinate.x,g.coordinate.y),t=Math.max(...e.map((e=>e[1])));a.FieldConstants.Height-2<t?l.piece=void 0:g.coordinate.y+=1}return n.sequence(e,[i.actions.registerHistoryTask({task:r.toSinglePageTask(t,u,l)}),()=>({fumen:{...e.fumen,pages:o}}),i.actions.reopenCurrentPage()])},shiftToBottom:()=>e=>{const t=e.fumen.currentIndex,o=e.fumen.pages,a=new s.Pages(o),d=o[t],l=r.toPrimitivePage(d),u=a.getField(t,s.PageFieldOperation.Command),m=u.copy();u.shiftToBottom();const p=d.piece;if(void 0===p&&m.equals(u))return;const g=a.getField(t,s.PageFieldOperation.None);if(d.commands=s.parseToCommands(g,u),void 0!==p){const e=c.getBlockPositions(p.type,p.rotation,p.coordinate.x,p.coordinate.y);Math.min(...e.map((e=>e[1])))<1?d.piece=void 0:p.coordinate.y-=1}return n.sequence(e,[i.actions.registerHistoryTask({task:r.toSinglePageTask(t,l,d)}),()=>({fumen:{...e.fumen,pages:o}}),i.actions.reopenCurrentPage()])},convertToGray:()=>e=>n.sequence(e,[i.actions.removeUnsettledItems(),t.convertToGoalField((e=>{const t=e.copy();return t.convertToGray(),t}))]),clearField:()=>e=>n.sequence(e,[i.actions.removeUnsettledItems(),t.convertToGoalField((e=>new d.Field({})))]),convertToMirror:()=>e=>n.sequence(e,[i.actions.removeUnsettledItems(),p()])},t.convertToGoalField=e=>t=>{const o=t.fumen.currentIndex,a=t.fumen.pages,c=new s.Pages(a),d=[],l=a[o];void 0===l.field.obj&&(c.toKeyPage(o),d.push(r.toKeyPageTask(o))),void 0!==l.comment.ref&&(c.freezeComment(o),d.push(r.toFreezeCommentTask(o)));const u=r.toPrimitivePage(l),m=c.getField(o,s.PageFieldOperation.Command),p=e(m);if(0===d.length&&m.equals(p))return;const g=c.getField(o,s.PageFieldOperation.None);return l.commands=s.parseToCommands(g,p),d.push(r.toSinglePageTask(o,u,l)),n.sequence(t,[i.actions.registerHistoryTask({task:r.toPageTaskStack(d,o)}),()=>({fumen:{...t.fumen,pages:a}}),i.actions.reopenCurrentPage()])};const l=e=>{switch(e){case a.Piece.J:return a.Piece.L;case a.Piece.L:return a.Piece.J;case a.Piece.S:return a.Piece.Z;case a.Piece.Z:return a.Piece.S}return e},u=e=>{const{type:t,rotation:o,coordinate:{x:n,y:i}}=e,r=c.getBlocks(t,o),s=n+Math.max(...r.map((e=>e[0]))),d=i+Math.min(...r.map((e=>e[1]))),u=l(t),m=(e=>{switch(e){case a.Rotation.Left:return a.Rotation.Right;case a.Rotation.Right:return a.Rotation.Left}return e})(o),p=c.getBlocks(u,m);return((e,t,o,n)=>({type:e,rotation:t,coordinate:{x:o,y:n}}))(u,m,9-s-Math.min(...p.map((e=>e[0]))),d-Math.min(...p.map((e=>e[1]))))},m=e=>{let t="";for(let o=0;o<e.length;o+=1)switch(e[o]){case"L":t+="J";break;case"J":t+="L";break;case"S":t+="Z";break;case"Z":t+="S";break;default:t+=e[o]}return t},p=()=>e=>{const t=e.fumen.currentIndex,o=e.fumen.pages,a=new s.Pages(o),c=[];let p=o.length;for(let e=t+1;e<o.length;e+=1)if(void 0!==o[e].field.obj){p=e;break}{const e=o[t];void 0===e.field.obj&&(a.toKeyPage(t),c.push(r.toKeyPageTask(t))),void 0!==e.comment.ref&&(a.freezeComment(t),c.push(r.toFreezeCommentTask(t)));const n=r.toPrimitivePage(e),i=a.getField(t,s.PageFieldOperation.Command),p=new d.Field({});for(let e=-1;e<23;e+=1)for(let t=0;t<10;t+=1){const o=i.get(9-t,e);p.add(t,e,l(o))}void 0!==e.piece&&(e.piece=u(e.piece));const g=a.getComment(t);if(s.isQuizCommentResult(g)){const e=m(g.quiz);a.setComment(t,e)}const h=a.getField(t,s.PageFieldOperation.None);e.commands=s.parseToCommands(h,p),c.push(r.toSinglePageTask(t,n,e))}for(let e=t+1;e<p;e+=1){const n=o[e],i=r.toPrimitivePage(n);void 0!==n.piece&&(n.piece=u(n.piece));const d=a.getComment(t);if(void 0!==n.comment.text&&s.isQuizCommentResult(d)){const e=m(d.quiz);a.setComment(t,e)}c.push(r.toSinglePageTask(e,i,n))}return n.sequence(e,[i.actions.registerHistoryTask({task:r.toPageTaskStack(c,t)}),()=>({fumen:{...e.fumen,pages:o}}),i.actions.reopenCurrentPage()])}},381:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawBlockActions=void 0;const n=o(9774),i=o(5917),r=o(9609),s=o(2995),a=o(6886),c=o(3876);t.drawBlockActions={fixInferencePiece:()=>e=>{const t=e.events.inferences;if(t.length<4)return;const o=c.inferPiece(t);if(!o)return;const n=o.piece,d=e.fumen.currentIndex,l=e.fumen.pages[d],u=s.toPrimitivePage(l);l.commands||(l.commands={pre:{}});for(const o of t){const t=o%10,i=Math.floor(o/10),r="block",s=`${r}-${o}`;e.cache.currentInitField.getAtIndex(o,!0)!==n?l.commands.pre[s]={x:t,y:i,piece:n,type:r}:delete l.commands.pre[s]}return r.sequence(e,[a.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:s.toSinglePageTask(d,u,l)})])},clearInferencePiece:()=>e=>r.sequence(e,[()=>({events:{...e.events,inferences:[]}})]),resetInferencePiece:()=>e=>r.sequence(e,[a.fieldEditorActions.clearInferencePiece(),i.actions.openPage({index:e.fumen.currentIndex})]),ontouchStartField:({index:e})=>t=>{if(void 0!==t.events.piece)return;if(void 0!==t.mode.piece)return r.sequence(t,[i.actions.fixInferencePiece(),t=>d(t,e,!0),i.actions.ontouchMoveField({index:e})]);const o=t.events.inferences;return r.sequence(t,[void 0===o.find((t=>t===e))?i.actions.fixInferencePiece():void 0,t=>({events:{...t.events,piece:void 0===t.events.inferences.find((t=>t===e))?n.Piece.Gray:n.Piece.Empty,updated:!1}}),i.actions.ontouchMoveField({index:e})])},ontouchMoveField:({index:e})=>t=>{if(void 0===t.events.piece)return;if(void 0!==t.mode.piece)return l(t,e,!0);const o=t.events.piece;if(void 0===o)return;const s=t.events.inferences;if(o!==n.Piece.Empty){if(4<=s.length)return;if(void 0===s.find((t=>t===e))){const o=t.events.inferences.concat([e]);return r.sequence(t,[()=>({events:{...t.events,inferences:o,updated:!0}}),i.actions.openPage({index:t.fumen.currentIndex})])}}return o===n.Piece.Empty?r.sequence(t,[()=>({events:{...t.events,inferences:t.events.inferences.filter((t=>t!==e)),updated:!0}}),i.actions.openPage({index:t.fumen.currentIndex})]):void 0},ontouchEnd:()=>e=>{if(void 0===e.events.piece)return;const t=e.fumen.currentIndex,o=e.fumen.pages[t],n=e.events.updated;return r.sequence(e,[n&&void 0!==e.events.prevPage?i.actions.registerHistoryTask({task:s.toSinglePageTask(t,e.events.prevPage,o)}):void 0,u])},ontouchStartSentLine:({index:e})=>t=>{if(void 0===t.events.piece)return void 0!==t.mode.piece?r.sequence(t,[()=>d(t,e,!1),i.actions.ontouchMoveSentLine({index:e})]):void 0},ontouchMoveSentLine:({index:e})=>t=>{if(void 0!==t.events.piece)return void 0!==t.mode.piece?l(t,e,!1):void 0}};const d=(e,t,o)=>{const a=e.fumen.currentIndex,c=(o?e.field[t]:e.sentLine[t]).piece!==e.mode.piece?e.mode.piece:n.Piece.Empty;if(void 0!==c)return r.sequence(e,[()=>({events:{...e.events,piece:c,prevPage:s.toPrimitivePage(e.fumen.pages[e.fumen.currentIndex]),updated:!1}}),i.actions.openPage({index:a})])},l=(e,t,o)=>{const n=e.fumen.pages,s=e.fumen.currentIndex,a=e.events.piece;if(void 0===a)return;if((o?e.field[t]:e.sentLine[t]).piece===a)return;const c=n[s];c.commands||(c.commands={pre:{}});{const n=t%10,i=Math.floor(t/10),r=o?"block":"sentBlock",s=`${r}-${t}`;e.cache.currentInitField.getAtIndex(t,o)!==a?c.commands.pre[s]={x:n,y:i,piece:a,type:r}:delete c.commands.pre[s]}return r.sequence(e,[()=>({fumen:{...e.fumen,pages:n},events:{...e.events,updated:!0}}),i.actions.openPage({index:s})])},u=e=>({events:{...e.events,piece:void 0,prevPage:void 0,updated:!1}})},6886:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fieldEditorActions=void 0;const n=o(9774),i=o(5917),r=o(9609),s=o(6312),a=o(381),c=o(1542),d=o(2995),l=o(2579),u=o(1983),m=o(7989),p=o(479),g=o(8286),h=o(8711);t.fieldEditorActions={fixInferencePiece:()=>e=>{switch(e.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.fixInferencePiece()(e);case n.TouchTypes.Piece:return s.putPieceActions.fixInferencePiece()(e)}},clearInferencePiece:()=>e=>{switch(e.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.clearInferencePiece()(e);case n.TouchTypes.Piece:return s.putPieceActions.clearInferencePiece()(e)}},resetInferencePiece:()=>e=>{switch(e.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.resetInferencePiece()(e);case n.TouchTypes.Piece:return s.putPieceActions.resetInferencePiece()(e)}},removeUnsettledItemsInField:()=>e=>r.sequence(e,[t.fieldEditorActions.fixInferencePiece(),t.fieldEditorActions.resetInferencePiece()]),ontouchStartField:({index:e})=>t=>{switch(t.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.ontouchStartField({index:e})(t);case n.TouchTypes.Piece:return s.putPieceActions.ontouchStartField({index:e})(t);case n.TouchTypes.MovePiece:return l.movePieceActions.ontouchStartField({index:e})(t);case n.TouchTypes.FillRow:return p.fillRowActions.ontouchStartField({index:e})(t);case n.TouchTypes.Fill:return c.fillActions.ontouchStartField({index:e})(t)}},ontouchMoveField:({index:e})=>t=>{switch(t.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.ontouchMoveField({index:e})(t);case n.TouchTypes.Piece:return s.putPieceActions.ontouchMoveField({index:e})(t);case n.TouchTypes.MovePiece:return l.movePieceActions.ontouchMoveField({index:e})(t);case n.TouchTypes.FillRow:return p.fillRowActions.ontouchMoveField({index:e})(t);case n.TouchTypes.Fill:return c.fillActions.ontouchMoveField({index:e})(t)}},ontouchEnd:()=>e=>{switch(e.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.ontouchEnd()(e);case n.TouchTypes.Piece:return s.putPieceActions.ontouchEnd()(e);case n.TouchTypes.MovePiece:return l.movePieceActions.ontouchEnd()(e);case n.TouchTypes.FillRow:return p.fillRowActions.ontouchEnd()(e);case n.TouchTypes.Fill:return c.fillActions.ontouchEnd()(e)}},ontouchStartSentLine:({index:e})=>t=>{switch(t.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.ontouchStartSentLine({index:e})(t);case n.TouchTypes.FillRow:return p.fillRowActions.ontouchStartSentLine({index:e})(t);case n.TouchTypes.Fill:return c.fillActions.ontouchStartSentLine({index:e})(t)}},ontouchMoveSentLine:({index:e})=>t=>{switch(t.mode.touch){case n.TouchTypes.Drawing:return a.drawBlockActions.ontouchMoveSentLine({index:e})(t);case n.TouchTypes.FillRow:return p.fillRowActions.ontouchMoveSentLine({index:e})(t);case n.TouchTypes.Fill:return c.fillActions.ontouchMoveSentLine({index:e})(t)}},selectPieceColor:({piece:e})=>t=>r.sequence(t,[i.actions.removeUnsettledItems(),t=>({mode:{...t.mode,piece:e}})]),selectInferencePieceColor:()=>e=>r.sequence(e,[i.actions.removeUnsettledItems(),e=>({mode:{...e.mode,piece:void 0}})]),spawnPiece:({piece:e,guideline:o})=>s=>{if(e===n.Piece.Gray||e===n.Piece.Empty)throw new g.ViewError(`Unsupported piece: ${e}`);const a=s.fumen.pages,c=s.fumen.currentIndex,l=a[c];if(void 0===l)return;let u;u=o?{type:e,rotation:n.Rotation.Spawn,coordinate:{x:4,y:20}}:e===n.Piece.I?{type:e,rotation:n.Rotation.Reverse,coordinate:{x:5,y:20}}:e===n.Piece.O?{type:e,rotation:n.Rotation.Reverse,coordinate:{x:5,y:21}}:{type:e,rotation:n.Rotation.Reverse,coordinate:{x:4,y:21}};const m=l.piece;if(void 0!==m&&m.type===u.type&&m.rotation===u.rotation&&m.coordinate.x===u.coordinate.x&&m.coordinate.y===u.coordinate.y)return r.sequence(s,[t.fieldEditorActions.resetInferencePiece()]);const p=d.toPrimitivePage(l);return l.piece=u,r.sequence(s,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(c,p,l)}),i.actions.reopenCurrentPage()])},clearPiece:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;if(void 0===s.piece)return t.fieldEditorActions.resetInferencePiece()(e);const a=d.toPrimitivePage(s);return s.piece=void 0,r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,a,s)}),i.actions.reopenCurrentPage()])},rotateToLeft:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=m.testLeftRotation(a.type,a.rotation),p=l.rotation,g=f(c,a.type,p),h=a.coordinate,y=l.test.map((e=>(e[0]+=h.x,e[1]+=h.y,e))).find((e=>g(e[0],e[1])));if(void 0===y)return;const v=d.toPrimitivePage(s);return s.piece={...a,rotation:p,coordinate:{x:y[0],y:y[1]}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,v,s)}),i.actions.reopenCurrentPage()])},rotateToRight:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=m.testRightRotation(a.type,a.rotation),p=l.rotation,g=f(c,a.type,p),h=a.coordinate,y=l.test.map((e=>(e[0]+=h.x,e[1]+=h.y,e))).find((e=>g(e[0],e[1])));if(void 0===y)return;const v=d.toPrimitivePage(s);return s.piece={...a,rotation:p,coordinate:{x:y[0],y:y[1]}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,v,s)}),i.actions.reopenCurrentPage()])},moveToLeft:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=f(c,a.type,a.rotation),m=a.coordinate;if(!l(m.x-1,m.y))return;const p=d.toPrimitivePage(s);return s.piece={...a,coordinate:{x:m.x-1,y:m.y}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,p,s)}),i.actions.reopenCurrentPage()])},moveToLeftEnd:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=f(c,a.type,a.rotation),m=a.coordinate;let p=m.x;for(;l(p-1,m.y);)p-=1;if(p===m.x)return;const g=d.toPrimitivePage(s);return s.piece={...a,coordinate:{x:p,y:m.y}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,g,s)}),i.actions.reopenCurrentPage()])},moveToRight:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=f(c,a.type,a.rotation),m=a.coordinate;if(!l(m.x+1,m.y))return;const p=d.toPrimitivePage(s);return s.piece={...a,coordinate:{x:m.x+1,y:m.y}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,p,s)}),i.actions.reopenCurrentPage()])},moveToRightEnd:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=f(c,a.type,a.rotation),m=a.coordinate;let p=m.x;for(;l(p+1,m.y);)p+=1;if(p===m.x)return;const g=d.toPrimitivePage(s);return s.piece={...a,coordinate:{x:p,y:m.y}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,g,s)}),i.actions.reopenCurrentPage()])},harddrop:()=>e=>{const o=e.fumen.pages,n=e.fumen.currentIndex,s=o[n];if(void 0===s)return;const a=s.piece;if(void 0===a)return;const c=new u.Pages(o).getField(n,u.PageFieldOperation.Command),l=f(c,a.type,a.rotation);let m=a.coordinate.y;for(let e=a.coordinate.y-1;0<=e&&l(a.coordinate.x,e);e-=1)m=e;if(m===a.coordinate.y)return;const p=d.toPrimitivePage(s);return s.piece={...a,coordinate:{...a.coordinate,y:m}},r.sequence(e,[t.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:d.toSinglePageTask(n,p,s)}),i.actions.reopenCurrentPage()])}};const f=(e,t,o)=>(i,r)=>{const s=h.getBlockPositions(t,o,i,r);return!s.some((e=>e[0]<0||10<=e[0]||e[1]<0||24<=e[1]))&&!s.map(n.toPositionIndex).some((t=>e.getAtIndex(t,!0)!==n.Piece.Empty))}},1542:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillActions=void 0;const n=o(5917),i=o(9609),r=o(2995);t.fillActions={ontouchStartField:({index:e})=>t=>{if(void 0===t.events.piece&&void 0!==t.mode.piece)return i.sequence(t,[e=>s(e),n.actions.ontouchMoveField({index:e})])},ontouchMoveField:({index:e})=>t=>{if(void 0!==t.events.piece&&void 0!==t.mode.piece)return i.sequence(t,[t=>a(t,e,!0)])},ontouchEnd:()=>e=>{if(void 0===e.events.piece)return;const t=e.fumen.currentIndex,o=e.fumen.pages[t],s=e.events.updated;return i.sequence(e,[s&&void 0!==e.events.prevPage?n.actions.registerHistoryTask({task:r.toSinglePageTask(t,e.events.prevPage,o)}):void 0,c])},ontouchStartSentLine:({index:e})=>t=>{if(void 0===t.events.piece&&void 0!==t.mode.piece)return i.sequence(t,[()=>s(t),n.actions.ontouchMoveSentLine({index:e})])},ontouchMoveSentLine:({index:e})=>t=>{if(void 0!==t.events.piece&&void 0!==t.mode.piece)return a(t,e,!1)}};const s=e=>{const t=e.fumen.currentIndex,o=e.mode.piece;if(void 0!==o)return i.sequence(e,[()=>({events:{...e.events,piece:o,prevPage:r.toPrimitivePage(e.fumen.pages[e.fumen.currentIndex]),updated:!1}}),n.actions.openPage({index:t})])},a=(e,t,o)=>{const r=e.fumen.pages,s=e.fumen.currentIndex,a=e.events.piece;if(void 0===a)return;const c=(o?e.field[t]:e.sentLine[t]).piece;if(c===a)return;const d=r[s];d.commands||(d.commands={pre:{}});const l=d.commands,u=o?e.field.concat():e.sentLine.concat(),m=Math.floor(u.length/10),p=t=>{if(!u[t]||u[t].piece!==c)return;delete u[t];const n=t%10,i=Math.floor(t/10),r=o?"block":"sentBlock",s=`${r}-${t}`;e.cache.currentInitField.getAtIndex(t,o)!==a?l.pre[s]={x:n,y:i,piece:a,type:r}:delete l.pre[s],0<n&&p(t-1),n<9&&p(t+1),0<i&&p(t-10),i<m-1&&p(t+10)};return p(t),i.sequence(e,[()=>({fumen:{...e.fumen,pages:r},events:{...e.events,updated:!0}}),n.actions.openPage({index:s})])},c=e=>({events:{...e.events,piece:void 0,prevPage:void 0,updated:!1}})},479:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillRowActions=void 0;const n=o(9774),i=o(5917),r=o(9609),s=o(2995);t.fillRowActions={ontouchStartField:({index:e})=>t=>{if(void 0===t.events.piece)return r.sequence(t,[e=>a(e),i.actions.ontouchMoveField({index:e})])},ontouchMoveField:({index:e})=>t=>{if(void 0!==t.events.piece)return r.sequence(t,[t=>c(t,e,!0),i.actions.reopenCurrentPage()])},ontouchEnd:()=>e=>{if(void 0===e.events.piece)return;const t=e.fumen.pages,o=e.fumen.currentIndex,n=t[o],a=e.events.prevPage;return r.sequence(e,[d,void 0!==a?i.actions.registerHistoryTask({task:s.toSinglePageTask(o,a,n)}):void 0])},ontouchStartSentLine:({index:e})=>t=>{if(void 0===t.events.piece)return r.sequence(t,[e=>a(e),i.actions.ontouchMoveSentLine({index:e})])},ontouchMoveSentLine:({index:e})=>t=>{if(void 0!==t.events.piece)return r.sequence(t,[t=>c(t,e,!1),i.actions.reopenCurrentPage()])}};const a=e=>{const t=e.fumen.pages,o=e.fumen.currentIndex;return{events:{...e.events,piece:e.mode.piece?e.mode.piece:n.Piece.Empty,updated:!1,prevPage:s.toPrimitivePage(t[o])}}},c=(e,t,o)=>{const s=e.events.piece;if(void 0===s)return;const a=e.fumen.currentIndex,c=e.fumen.pages,d=c[a];if(void 0===d)return;d.commands||(d.commands={pre:{}});const l=t%10,u=Math.floor(t/10);for(let t=0;t<10;t+=1){const i=t+10*u,r=o?"block":"sentBlock",a=`${r}-${i}`,c=e.cache.currentInitField.getAtIndex(i,!0);l!==t&&c!==s?d.commands.pre[a]={x:t,piece:s,type:r,y:u}:l===t&&c!==n.Piece.Empty?d.commands.pre[a]={x:t,type:r,piece:n.Piece.Empty,y:u}:delete d.commands.pre[a]}return r.sequence(e,[e=>({fumen:{...e.fumen,pages:c}}),i.actions.reopenCurrentPage()])},d=e=>({events:{...e.events,piece:void 0,prevPage:void 0,updated:!1}})},2281:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mementoActions=void 0;const n=o(9609),i=o(5917),r=o(6266);t.mementoActions={registerHistoryTask:({task:e,mergeKey:o})=>i=>{const a=r.memento.register(e,o);return n.sequence(i,[t.mementoActions.setHistoryCount({undoCount:a,redoCount:0}),s])},undo:()=>e=>0<e.events.inferences.length?n.sequence(e,[i.actions.clearInferencePiece(),i.actions.openPage({index:e.fumen.currentIndex})]):e.history.undoCount<=0?void 0:n.sequence(e,[e=>{(async()=>{const t=await r.memento.undo(e.fumen.pages);void 0!==t&&i.main.loadPagesViaHistory(t)})()}]),redo:()=>e=>{if(!(e.history.redoCount<=0))return n.sequence(e,[i.actions.fixInferencePiece(),i.actions.clearInferencePiece(),e=>{(async()=>{const t=await r.memento.redo(e.fumen.pages);void 0!==t&&i.main.loadPagesViaHistory(t)})()}])},loadPagesViaHistory:({pages:e,index:t,undoCount:o,redoCount:r})=>a=>n.sequence(a,[i.actions.setPages({pages:e,open:!1}),i.actions.openPage({index:t}),i.actions.setHistoryCount({undoCount:o,redoCount:r}),s]),setHistoryCount:({undoCount:e,redoCount:t})=>()=>({history:{undoCount:e,redoCount:t}})};const s=e=>{r.memento.save(e.fumen.pages)}},7270:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modalActions=void 0;const n=o(9609);t.modalActions={showOpenErrorMessage:({message:e})=>t=>n.sequence(t,[()=>({fumen:{...t.fumen,errorMessage:e}})]),openFumenModal:()=>e=>({modal:{...e.modal,fumen:!0}}),openMenuModal:()=>e=>({modal:{...e.modal,menu:!0}}),openAppendModal:()=>e=>({modal:{...e.modal,append:!0}}),openClipboardModal:()=>e=>({modal:{...e.modal,clipboard:!0}}),openUserSettingsModal:()=>e=>({modal:{...e.modal,userSettings:!0}}),closeFumenModal:()=>e=>({modal:{...e.modal,fumen:!1}}),closeMenuModal:()=>e=>({modal:{...e.modal,menu:!1}}),closeAppendModal:()=>e=>({modal:{...e.modal,append:!1}}),closeClipboardModal:()=>e=>({modal:{...e.modal,clipboard:!1}}),closeUserSettingsModal:()=>e=>({modal:{...e.modal,userSettings:!1}}),closeAllModals:()=>()=>({modal:{append:!1,fumen:!1,menu:!1,clipboard:!1,userSettings:!1}})}},2579:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.movePieceActions=void 0;const n=o(5917),i=o(9609),r=o(9774),s=o(2995),a=o(1983),c=o(8711);t.movePieceActions={ontouchStartField:({index:e})=>o=>{if(!o.events.drawing)return i.sequence(o,[()=>({events:{...o.events,drawing:!0,prevPage:s.toPrimitivePage(o.fumen.pages[o.fumen.currentIndex]),updated:!1}}),t.movePieceActions.ontouchMoveField({index:e})])},ontouchMoveField:({index:e})=>t=>{if(!t.events.drawing)return;const o=t.fumen.pages,s=t.fumen.currentIndex,d=o[s];if(void 0===d)return;const l=d.piece;if(void 0===l)return;if(!r.isMinoPiece(l.type))return;const u=e%10,m=Math.floor(e/10),p=c.getBlockPositions(l.type,l.rotation,u,m);if(p.some((e=>e[0]<0||10<=e[0]||e[1]<0||24<=e[1])))return;const g=new a.Pages(o).getField(s,a.PageFieldOperation.Command);return p.map(r.toPositionIndex).some((e=>g.getAtIndex(e,!0)!==r.Piece.Empty))?void 0:(d.piece={...l,coordinate:{x:u,y:m}},i.sequence(t,[()=>({fumen:{...t.fumen,pages:o},events:{...t.events,updated:!0}}),n.actions.reopenCurrentPage()]))},ontouchEnd:()=>e=>{if(!e.events.drawing)return;const t=e.fumen.currentIndex,o=e.fumen.pages[t],r=e.events.updated;return i.sequence(e,[r&&void 0!==e.events.prevPage?n.actions.registerHistoryTask({task:s.toSinglePageTask(t,e.events.prevPage,o)}):void 0,()=>({events:{...e.events,prevPage:void 0,updated:!1,drawing:!1}})])}}},2265:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseToBlocks=t.pageActions=void 0;const n=o(5917),i=o(9609),r=o(9774),s=o(1983),a=o(2995),c=o(8286),d=o(9782);t.pageActions={reopenCurrentPage:()=>e=>t.pageActions.openPage({index:e.fumen.currentIndex})(e),openPage:({index:e})=>o=>{const a=new s.Pages(o.fumen.pages),c=a.getComment(e);let d,l,u;s.isQuizCommentResult(c)?(d=c.quiz,""!==c.quiz&&(l=c.quizAfterOperation.getNextPieces(5).filter((e=>e!==r.Piece.Empty)),u=c.quizAfterOperation.getHoldPiece())):(d=c.text,l=c.next,u=void 0);const m=a.getField(e,s.PageFieldOperation.None),p=o.fumen.pages[e],g=t.parseToBlocks(m,p.piece,p.commands),h=void 0===o.fumen.pages[0]||o.fumen.pages[0].flags.colorize;return i.sequence(o,[o.play.status===r.AnimationState.Play?n.actions.startAnimation():void 0,o.fumen.currentIndex!==e?n.actions.fixInferencePiece():void 0,o.fumen.currentIndex!==e?n.actions.clearInferencePiece():void 0,o.fumen.currentIndex!==e?n.actions.commitCommentText():void 0,n.actions.setComment({comment:d}),n.actions.setField({field:g.playField,move:p.piece,filledHighlight:p.flags.lock,inferences:o.events.inferences,ghost:o.mode.ghostVisible,allowSplit:o.mode.touch===r.TouchTypes.Drawing}),n.actions.setFieldColor({guideLineColor:h}),n.actions.setSentLine({sentLine:g.sentLine}),n.actions.setHold({hold:u}),n.actions.setNext({next:l}),t=>({fumen:{...t.fumen,currentIndex:e},cache:{...t.cache,currentInitField:m}})])},openPageWhenChange:({index:e})=>o=>{if(o.fumen.currentIndex!==e)return t.pageActions.openPage({index:e})(o)},insertPage:({index:e})=>o=>{const n=o.fumen.pages[e-1];return(void 0!==n&&void 0===n.field.obj?t.pageActions.insertRefPage:t.pageActions.insertKeyPage)({index:e})(o)},insertRefPage:({index:e})=>t=>{if(!(t.fumen.pages.length<e))return i.sequence(t,[n.actions.removeUnsettledItems(),n.actions.commitCommentText(),l({index:e}),n.actions.reopenCurrentPage()])},insertKeyPage:({index:e})=>t=>{if(!(t.fumen.pages.length<e))return i.sequence(t,[n.actions.removeUnsettledItems(),n.actions.commitCommentText(),u({index:e}),n.actions.reopenCurrentPage()])},insertNewPage:({index:e})=>t=>{if(!(t.fumen.pages.length<e))return i.sequence(t,[n.actions.removeUnsettledItems(),n.actions.commitCommentText(),m({index:e}),n.actions.reopenCurrentPage()])},duplicatePage:({index:e})=>t=>{if(!(t.fumen.pages.length<e))return i.sequence(t,[n.actions.removeUnsettledItems(),n.actions.commitCommentText(),p({index:e}),n.actions.reopenCurrentPage()])},removePage:({index:e})=>t=>i.sequence(t,[n.actions.removeUnsettledItems(),n.actions.commitCommentText(),g({index:e}),n.actions.reopenCurrentPage()]),removeUnsettledItems:()=>e=>n.actions.removeUnsettledItemsInField()(e),backLoopPage:()=>e=>{const o=(e.fumen.currentIndex-1+e.fumen.maxPage)%e.fumen.maxPage;return t.pageActions.openPage({index:o})(e)},nextLoopPage:()=>e=>{const o=(e.fumen.currentIndex+1)%e.fumen.maxPage;return t.pageActions.openPage({index:o})(e)},backPage:({loop:e})=>o=>{const r=o.fumen.currentIndex-1;return r<0?e?i.sequence(o,[n.actions.lastPage()]):void 0:i.sequence(o,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),n.actions.commitCommentText(),t.pageActions.openPage({index:r})])},nextPage:({loop:e})=>o=>{const r=o.fumen,s=r.currentIndex+1;return r.maxPage<=s?e?i.sequence(o,[n.actions.firstPage()]):void 0:i.sequence(o,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),n.actions.commitCommentText(),t.pageActions.openPage({index:s})])},nextPageOrNewPage:()=>e=>{const o=e.fumen,r=o.currentIndex+1;return o.maxPage<=r?i.sequence(e,[t.pageActions.insertPage({index:r}),t.pageActions.openPage({index:r})]):i.sequence(e,[n.actions.nextPage({loop:!1})])},firstPage:()=>e=>i.sequence(e,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),t.pageActions.openPage({index:0})]),lastPage:()=>e=>i.sequence(e,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),t.pageActions.openPage({index:e.fumen.pages.length-1})]),changeToRef:({index:e})=>o=>{if(e<=0)return;const r=a.toRefPageTask(e);return i.sequence(o,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),n.actions.registerHistoryTask({task:r}),t=>{const o=new s.Pages(t.fumen.pages);return o.toRefPage(e),{fumen:{...t.fumen,pages:o.pages}}},e=>t.pageActions.openPage({index:e.fumen.currentIndex})(e)])},changeToKey:({index:e})=>o=>{if(e<=0)return;const r=a.toKeyPageTask(e);return i.sequence(o,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),n.actions.registerHistoryTask({task:r}),t=>{const o=new s.Pages(t.fumen.pages);return o.toKeyPage(e),{fumen:{...t.fumen,pages:o.pages}}},e=>t.pageActions.openPage({index:e.fumen.currentIndex})(e)])},changeLockFlag:({index:e,enable:t})=>o=>{const r=o.fumen.pages;if(e<0||r.length<=e)return;const s=r[e],c=a.toPrimitivePage(s);s.flags.lock=t;const d=a.toSinglePageTask(e,c,s);return i.sequence(o,[n.actions.registerHistoryTask({task:d}),e=>({fumen:{...e.fumen,pages:r}}),n.actions.reopenCurrentPage()])},changeRiseFlag:({index:e,enable:t})=>o=>{const r=o.fumen.pages;if(e<0||r.length<=e)return;const s=r[e],c=a.toPrimitivePage(s);s.flags.rise=t;const d=a.toSinglePageTask(e,c,s);return i.sequence(o,[n.actions.registerHistoryTask({task:d}),e=>({fumen:{...e.fumen,pages:r}})])},changeMirrorFlag:({index:e,enable:t})=>o=>{const r=o.fumen.pages;if(e<0||r.length<=e)return;const s=r[e],c=a.toPrimitivePage(s);s.flags.mirror=t;const d=a.toSinglePageTask(e,c,s);return i.sequence(o,[n.actions.registerHistoryTask({task:d}),e=>({fumen:{...e.fumen,pages:r}})])},clearToEnd:()=>e=>i.sequence(e,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),n.actions.commitCommentText(),h({pageIndex:e.fumen.currentIndex}),n.actions.reopenCurrentPage()]),clearPast:()=>e=>i.sequence(e,[n.actions.fixInferencePiece(),n.actions.clearInferencePiece(),n.actions.commitCommentText(),f({pageIndex:e.fumen.currentIndex}),n.actions.reopenCurrentPage()])},t.parseToBlocks=(e,t,o)=>{const n=e=>({piece:e}),i=e.toPlayFieldPieces().map(n),r=e.toSentLintPieces().map(n);return void 0!==o&&Object.keys(o.pre).map((e=>o.pre[e])).forEach((e=>{switch(e.type){case"block":{const{x:t,y:o,piece:n}=e;return void(i[t+10*o]={piece:n})}case"sentBlock":{const{x:t,y:o,piece:n}=e;return void(r[t+10*o]={piece:n})}}})),{playField:i,sentLine:r}};const l=({index:e})=>t=>{const o=new s.Pages(t.fumen.pages);o.insertRefPage(e);const r=o.pages,c=a.toInsertPageTask(e,[a.toPrimitivePage(r[e])],t.fumen.currentIndex);return i.sequence(t,[n.actions.registerHistoryTask({task:c}),()=>({fumen:{...t.fumen,pages:r,maxPage:r.length}})])},u=({index:e})=>t=>{const o=new s.Pages(t.fumen.pages);o.insertKeyPage(e);const r=o.pages,c=a.toInsertPageTask(e,[a.toPrimitivePage(r[e])],t.fumen.currentIndex);return i.sequence(t,[n.actions.registerHistoryTask({task:c}),()=>({fumen:{...t.fumen,pages:r,maxPage:r.length}})])},m=({index:e})=>t=>{let o=t.fumen.pages;const r=[],c=o[e];if(void 0!==c&&void 0!==c.field.ref){const t=new s.Pages(o);t.toKeyPage(e),o=t.pages;const n=a.toKeyPageTask(e);r.push(n)}if(void 0!==c&&void 0!==c.comment.ref){const t=new s.Pages(o);t.freezeComment(e),o=t.pages;const n=a.toFreezeCommentTask(e);r.push(n)}{const n=new s.Pages(o);n.insertKeyPage(e),o=n.pages;const i=a.toInsertPageTask(e,[a.toPrimitivePage(o[e])],t.fumen.currentIndex);r.push(i)}const l=o[e];if(void 0!==l&&void 0===l.comment.text){const t=new s.Pages(o);t.freezeComment(e),o=t.pages;const n=a.toFreezeCommentTask(e);r.push(n)}const u=a.toPrimitivePage(l);void 0!==l.field.obj&&(l.field.obj=new d.Field({})),void 0!==l.comment.text&&(l.comment.text="");{const t=a.toSinglePageTask(e,u,l);r.push(t)}return i.sequence(t,[n.actions.registerHistoryTask({task:a.toPageTaskStack(r,t.fumen.currentIndex)}),()=>({fumen:{...t.fumen,pages:o,maxPage:o.length,currentIndex:e}})])},p=({index:e})=>t=>{const o=new s.Pages(t.fumen.pages);o.duplicatePage(e);const r=o.pages,c=a.toInsertPageTask(e,[a.toPrimitivePage(r[e])],t.fumen.currentIndex);return i.sequence(t,[n.actions.registerHistoryTask({task:c}),()=>({fumen:{...t.fumen,pages:r,maxPage:r.length}})])},g=({index:e})=>t=>{const o=t.fumen.pages;if(e<0)throw new c.FumenError(`Illegal index: ${e}`);if(o.length<=1)return;const r=o[e],d=e+1,l=o[d],u=new s.Pages(o),m=[];if(void 0!==l&&(void 0===l.field.obj&&(u.toKeyPage(d),m.push(a.toKeyPageTask(d))),void 0!==l.comment.ref&&(u.freezeComment(d),m.push(a.toFreezeCommentTask(d))),0===e&&r.flags.colorize!==l.flags.colorize)){const e=a.toPrimitivePage(l);l.flags.colorize=r.flags.colorize,m.push(a.toSinglePageTask(d,e,l))}{const t=a.toPrimitivePage(r);u.deletePage(e,e+1),m.push(a.toRemovePageTask(e,e+1,[t],e))}const p=u.pages,g=e<p.length?e:p.length-1;return i.sequence(t,[n.actions.registerHistoryTask({task:a.toPageTaskStack(m,e)}),()=>({fumen:{...t.fumen,pages:p,maxPage:p.length,currentIndex:g}})])},h=({pageIndex:e})=>t=>{const o=t.fumen.pages;if(e<0)throw new c.FumenError(`Illegal index: ${e}`);const r=e+1;if(o.length<=1||o.length<=r)return;const d=new s.Pages(o),l=o.slice(r).map(a.toPrimitivePage);d.deletePage(r,o.length);const u=a.toRemovePageTask(r,o.length,l,e),m=d.pages,p=e<m.length?e:m.length-1;return i.sequence(t,[n.actions.registerHistoryTask({task:u}),()=>({fumen:{...t.fumen,pages:m,maxPage:m.length,currentIndex:p}})])},f=({pageIndex:e})=>t=>{const o=t.fumen.pages;if(e<0)throw new c.FumenError(`Illegal index: ${e}`);if(o.length<=1||0===e)return;const r=o[0];if(void 0===r)return;const d=o[e],l=new s.Pages(o),u=[];if(void 0!==d&&(void 0===d.field.obj&&(l.toKeyPage(e),u.push(a.toKeyPageTask(e))),void 0!==d.comment.ref&&(l.freezeComment(e),u.push(a.toFreezeCommentTask(e))),r.flags.colorize!==d.flags.colorize)){const t=a.toPrimitivePage(d);d.flags.colorize=r.flags.colorize,u.push(a.toSinglePageTask(e,t,d))}{const t=o.slice(0,e).map(a.toPrimitivePage);l.deletePage(0,e),u.push(a.toRemovePageTask(0,e,t,0))}const m=l.pages;return i.sequence(t,[n.actions.registerHistoryTask({task:a.toPageTaskStack(u,e)}),()=>({fumen:{...t.fumen,pages:m,maxPage:m.length,currentIndex:0}}),n.actions.reopenCurrentPage()])}},6312:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.putPieceActions=void 0;const n=o(9774),i=o(5917),r=o(9609),s=o(2995),a=o(6886),c=o(3876),d=o(6266),l=o(8711),u=o(7587);t.putPieceActions={fixInferencePiece:()=>e=>{const t=p(e);if(void 0===t)return;const o=t.task;return m(t.pages,o)(e)},clearInferencePiece:()=>e=>r.sequence(e,[()=>({events:{...e.events,inferences:[]},cache:{...e.cache,taskKey:void 0}})]),resetInferencePiece:()=>e=>r.sequence(e,[a.fieldEditorActions.clearInferencePiece(),i.actions.openPage({index:e.fumen.currentIndex})]),ontouchStartField:({index:e})=>t=>{if(void 0!==t.events.piece)return;const o=g(t,e);if(void 0!==o)return r.sequence(t,[()=>o,i.actions.ontouchMoveField({index:e})]);const n=t.fumen.currentIndex+1;return r.sequence(t,[i.actions.insertPage({index:n}),i.actions.openPage({index:n}),e=>({cache:{...e.cache,taskKey:d.memento.lastKey()}}),t=>g(t,e),i.actions.ontouchMoveField({index:e})])},ontouchMoveField:({index:e})=>t=>{const o=t.events.piece;if(void 0===o)return;const s=t.fumen.pages[t.fumen.currentIndex];if(void 0===s)return;if(void 0!==s.piece)return;const a=t.events.inferences;if(o!==n.Piece.Empty){if(4<=a.length)return;if(void 0===a.find((t=>t===e))){const o=t.events.inferences.concat([e]);return r.sequence(t,[u.convertToGoalField((t=>{const o=t.copy();return o.deleteAt(e),o})),()=>({events:{...t.events,inferences:o,updated:!0}}),i.actions.openPage({index:t.fumen.currentIndex})])}}return o===n.Piece.Empty?r.sequence(t,[()=>({events:{...t.events,inferences:t.events.inferences.filter((t=>t!==e)),updated:!0}}),i.actions.openPage({index:t.fumen.currentIndex})]):void 0},ontouchEnd:()=>e=>{if(void 0===e.events.piece)return;const t=p(e);return r.sequence(e,[void 0!==t?m(t.pages,t.task,e.cache.taskKey):void 0,h])}};const m=(e,t,o)=>n=>r.sequence(n,[t=>({fumen:{...t.fumen,pages:e},cache:{...t.cache,taskKey:void 0}}),a.fieldEditorActions.resetInferencePiece(),i.actions.registerHistoryTask({task:t,mergeKey:o})]),p=e=>{const t=e.events.inferences;if(t.length<4)return;const o=c.inferPiece(t);if(!o||!o.coordinate)return;const n=e.fumen.currentIndex,i=e.fumen.pages,r=i[n],a=s.toPrimitivePage(r);return r.piece={type:o.piece,rotation:o.rotate,coordinate:o.coordinate},{pages:i,task:s.toSinglePageTask(n,a,r)}},g=(e,t)=>{const o=e.fumen.pages,i=o[e.fumen.currentIndex],r=i.piece;let s;s=void 0===r?e.events.inferences:l.getBlockPositions(r.type,r.rotation,r.coordinate.x,r.coordinate.y).map(n.toPositionIndex);const a=void 0!==s.find((e=>e===t));if(void 0===r||a)return i.piece=void 0,{fumen:{...e.fumen,pages:o},events:{...e.events,inferences:s,piece:a?n.Piece.Empty:n.Piece.Gray,updated:!1}}},h=e=>({events:{...e.events,piece:void 0,prevPage:void 0,updated:!1},cache:{...e.cache}})},5597:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.modeActions=void 0;const n=o(9609),i=o(5917),r=o(9774),s=o(6314),a=o(8456);t.modeActions={changeToReaderScreen:()=>e=>(s.resources.konva.stage.reload((e=>{i.main.changeScreen({screen:r.Screens.Reader}),e()})),n.sequence(e,[i.actions.fixInferencePiece(),i.actions.resetInferencePiece()])),changeToDrawerScreen:({refresh:e})=>t=>(s.resources.konva.stage.reload((e=>{i.main.changeScreen({screen:r.Screens.Editor}),e()})),n.sequence(t,[a.animationActions.pauseAnimation(),e?i.actions.changeToDrawingToolMode():void 0])),changeToDrawingMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.Drawing}),d({type:r.ModeTypes.Drawing})]),changeToDrawingToolMode:()=>e=>n.sequence(e,[d({type:r.ModeTypes.DrawingTool})]),changeToFlagsMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.Drawing}),d({type:r.ModeTypes.Flags})]),changeToUtilsMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.Drawing}),d({type:r.ModeTypes.Utils})]),changeToShiftMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.Drawing,clear:!0}),d({type:r.ModeTypes.Slide})]),changeToFillRowMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.FillRow}),d({type:r.ModeTypes.FillRow}),e=>({mode:{...e.mode,piece:void 0!==e.mode.piece?e.mode.piece:r.Piece.Gray}})]),changeToPieceMode:()=>e=>n.sequence(e,[d({type:r.ModeTypes.Piece})]),changeToFillMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.Fill}),d({type:r.ModeTypes.Fill})]),changeToCommentMode:()=>e=>n.sequence(e,[d({type:r.ModeTypes.Comment})]),changeToDrawPieceMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.Piece}),d({type:r.ModeTypes.Piece})]),changeToMovePieceMode:()=>e=>n.sequence(e,[c({type:r.TouchTypes.MovePiece}),d({type:r.ModeTypes.Piece})]),changeToSelectPieceMode:()=>e=>n.sequence(e,[d({type:r.ModeTypes.SelectPiece})]),changeScreen:({screen:e})=>t=>({mode:{...t.mode,screen:e}}),changeCommentMode:({type:e})=>t=>({mode:{...t.mode,comment:e}}),changeGhostVisible:({visible:e})=>t=>{if(t.mode.ghostVisible!==e)return n.sequence(t,[t=>({mode:{...t.mode,ghostVisible:e}})])},changeLoop:({enable:e})=>t=>{if(t.mode.loop!==e)return n.sequence(t,[t=>({mode:{...t.mode,loop:e}})])}};const c=({type:e,clear:t=!1})=>o=>o.mode.touch===e?t?i.actions.removeUnsettledItems()(o):void 0:n.sequence(o,[i.actions.removeUnsettledItems(),()=>({mode:{...o.mode,touch:e}})]),d=({type:e})=>t=>{if(t.mode.type!==e)return{mode:{...t.mode,type:e}}}},9986:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setterActions=void 0;const n=o(5917),i=o(9774),r=o(2742),s=o(3876),a=o(5187),c=o(8711);t.setterActions={setPages:({pages:e,open:t=!0})=>o=>{if(!(e.length<1))return t&&setTimeout((()=>{n.main.openPage({index:0})}),0),{fumen:{...o.fumen,pages:e,maxPage:e.length}}},updateFumenData:({value:e})=>t=>({fumen:{...t.fumen,value:e,errorMessage:void 0}}),clearFumenData:()=>e=>({fumen:{...e.fumen,value:void 0,errorMessage:void 0}}),setComment:({comment:e})=>t=>{const o=void 0!==e&&e!==t.comment.text,n=void 0!==e?e:t.comment.text;if(o!==t.comment.isChanged||n!==t.comment.text)return{comment:{isChanged:o,text:n,changeKey:a.generateKey()}}},setField:({field:e,move:t,filledHighlight:o,inferences:n,ghost:a,allowSplit:d})=>()=>{const l=e.concat();let u,m;if(void 0!==t&&a){const e=t.type;for(let o=t.coordinate.y-1;0<=o&&c.getBlockPositions(e,t.rotation,t.coordinate.x,o).every((([e,t])=>i.isInPlayField(e,t)&&l[e+10*t].piece===i.Piece.Empty));o-=1)u=o}if(void 0!==t){const e=t.type,o=c.getBlockPositions(e,t.rotation,t.coordinate.x,t.coordinate.y);for(const[t,n]of o)i.isInPlayField(t,n)&&(l[t+10*n]={piece:e,highlight:r.HighlightType.Highlight2})}if(o)for(let t=0;t<i.FieldConstants.Height+i.FieldConstants.SentLine;t+=1){const[o,n]=[t*i.FieldConstants.Width,(t+1)*i.FieldConstants.Width];if(l.slice(o,n).every((e=>e.piece!==i.Piece.Empty)))for(let t=o;t<n;t+=1){const o=l[t];if(void 0!==o){const e=o.highlight;l[t].highlight=void 0!==e&&r.HighlightType.Highlight1<e?e:r.HighlightType.Highlight1}else l[t]={...e[t]}}}if(void 0!==t&&void 0!==u){const e=t.type,o=c.getBlockPositions(e,t.rotation,t.coordinate.x,u);for(const[t,n]of o){const o=l[t+10*n];void 0!==o&&o.piece!==i.Piece.Empty||(l[t+10*n]={piece:e,highlight:r.HighlightType.Lighter})}}const p=s.inferPiece(n);if(p&&(p.coordinate||!p.coordinate&&d)&&(m=p.piece),m)for(const t of n)l[t]={...e[t],piece:m,highlight:r.HighlightType.Highlight2};else for(const t of n)l[t]={...e[t],piece:"inference",highlight:r.HighlightType.Highlight2};return{field:l}},setFieldColor:({guideLineColor:e})=>t=>({fumen:{...t.fumen,guideLineColor:e}}),setSentLine:({sentLine:e})=>()=>({sentLine:e}),setHold:({hold:e})=>()=>({hold:e}),setNext:({next:e})=>()=>({nexts:e})}},9164:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userSettingsActions=void 0;const n=o(5917),i=o(9609),r=o(6266);t.userSettingsActions={copyUserSettingsToTemporary:()=>e=>({temporary:{...e.temporary,userSettings:{ghostVisible:e.mode.ghostVisible,loop:e.mode.loop}}}),commitUserSettings:()=>e=>i.sequence(e,[e.mode.ghostVisible!==e.temporary.userSettings.ghostVisible?n.actions.changeGhostVisible({visible:e.temporary.userSettings.ghostVisible}):void 0,e.mode.loop!==e.temporary.userSettings.loop?n.actions.changeLoop({enable:e.temporary.userSettings.loop}):void 0,s,n.actions.reopenCurrentPage()]),keepGhostVisible:({visible:e})=>t=>{if(t.modal.userSettings)return{temporary:{...t.temporary,userSettings:{...t.temporary.userSettings,ghostVisible:e}}}},keepLoop:({enable:e})=>t=>{if(t.modal.userSettings)return{temporary:{...t.temporary,userSettings:{...t.temporary.userSettings,loop:e}}}}};const s=e=>{r.localStorageWrapper.saveUserSettings({ghostVisible:e.mode.ghostVisible,loop:e.mode.loop})}},9632:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utilsActions=void 0;const n=o(9609),i=o(5917),r=o(2315),s=o(4257),a=o(8286),c=o(2995),d=o(1983);t.utilsActions={resize:({width:e,height:t})=>o=>({display:{...o.display,width:e,height:t}}),commitOpenFumenData:()=>e=>{const t=e.fumen.value;if(t)return u(t,!1)},loadFumen:({fumen:e,purgeOnFailed:t=!1})=>()=>u(e,t),loadNewFumen:()=>e=>t.utilsActions.loadFumen({fumen:"v115@vhAAgH"})(e),loadPages:({pages:e,loadedFumen:t})=>o=>{const r=o.fumen.pages.map(c.toPrimitivePage),s=o.fumen.currentIndex;return n.sequence(o,[i.actions.setPages({pages:e}),i.actions.registerHistoryTask({task:c.toFumenTask(r,t,s)})])},commitAppendFumenData:({position:e})=>t=>{const o=t.fumen.value;if(o)switch(e){case"end":return m(o,t.fumen.maxPage);case"next":return m(o,t.fumen.currentIndex+1);default:return}},appendPages:({pages:e,pageIndex:t})=>o=>n.sequence(o,[l({pageIndex:t,appendedPages:e,indexAfterReverting:o.fumen.currentIndex})]),refresh:()=>()=>({}),openInPC:()=>e=>n.sequence(e,[i.actions.removeUnsettledItemsInField(),e=>{(async()=>`v115@${await r.encode(e.fumen.pages)}`)().then((e=>{const t=s.i18n.Navigator.ExternalFumenURL(e);window.open(t,"_blank")})).catch((e=>{M.toast({html:`Failed to open in PC: ${e}`,classes:"top-toast",displayLength:1500})}))}]),ontapCanvas:e=>t=>{const o=e.currentTarget.getStage(),{x:n}=o.getPointerPosition(),{width:r}=o.getSize();return(n/r<.5?i.actions.backPage({loop:t.mode.loop}):i.actions.nextPage({loop:t.mode.loop}))(t)}};const l=({pageIndex:e,appendedPages:t,indexAfterReverting:o})=>r=>{const s=r.fumen.pages;if(e<0)throw new a.FumenError(`Illegal index: ${e}`);const l=s[e],u=new d.Pages(s),m=[];if(void 0!==l){void 0===l.field.obj&&(u.toKeyPage(e),m.push(c.toKeyPageTask(e))),void 0!==l.comment.ref&&(u.freezeComment(e),m.push(c.toFreezeCommentTask(e)));const t=s[0];if(void 0===t||t.flags.colorize!==l.flags.colorize){const o=c.toPrimitivePage(l);l.flags.colorize=void 0===t||t.flags.colorize,m.push(c.toSinglePageTask(e,o,l))}}{const n=t.map(c.toPrimitivePage);u.insertPage(e,t),m.push(c.toInsertPageTask(e,n,o))}const p=u.pages;return n.sequence(r,[i.actions.registerHistoryTask({task:c.toPageTaskStack(m,o)}),()=>({fumen:{...r.fumen,pages:p,maxPage:p.length,currentIndex:e}}),i.actions.reopenCurrentPage()])},u=(e,t)=>{i.main.pauseAnimation(),void 0!==e?(async()=>{let o;try{o=await r.decode(e)}catch(e){return console.error(e),void(t?i.main.loadNewFumen():e instanceof a.FumenError?i.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.FailedToLoad()}):i.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.Unexpected(e.message)}))}try{i.main.loadPages({pages:o,loadedFumen:e}),i.main.closeAllModals(),i.main.clearFumenData()}catch(e){console.error(e),t?i.main.loadNewFumen():i.main.showOpenErrorMessage({message:s.i18n.OpenFumen.Errors.Unexpected(e.message)})}})():i.main.showOpenErrorMessage({message:""})},m=(e,t)=>{i.main.pauseAnimation(),void 0!==e?(async()=>{let o;try{o=await r.decode(e)}catch(e){return console.error(e),void(e instanceof a.FumenError?i.main.showOpenErrorMessage({message:s.i18n.AppendFumen.Errors.FailedToLoad()}):i.main.showOpenErrorMessage({message:s.i18n.AppendFumen.Errors.Unexpected(e.message)}))}try{i.main.appendPages({pages:o,pageIndex:t}),i.main.closeAllModals(),i.main.clearFumenData()}catch(e){console.error(e),i.main.showOpenErrorMessage({message:s.i18n.AppendFumen.Errors.Unexpected(e.message)})}})():i.main.showOpenErrorMessage({message:""})}},4272:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SizedIcon=t.BlockIcon=t.Icon=void 0;const n=o(4055),i=o(6540);t.Icon=({key:e,classNames:t=[],iconSize:o},r)=>{const s=["notranslate","material-icons"].concat(t).join(" ");return i.h("i",{key:e,class:s,style:n.style({fontSize:n.px(o)})},r)},t.BlockIcon=({key:e,classNames:t=[],iconSize:o},r)=>{const s=["notranslate","material-icons"].concat(t).join(" ");return i.h("i",{key:e,class:s,style:n.style({display:"block",fontSize:n.px(o),margin:n.px(0)})},r)},t.SizedIcon=({height:e,fontSize:t,colors:o,enable:r},s)=>{const a=r?o.darkCode:o.baseCode,c=n.style({display:"block",fontSize:n.px(t),height:n.px(e),lineHeight:n.px(e),width:"100%",border:`solid 1px ${a}`,boxSizing:"border-box",textAlign:"center",cursor:"pointer",color:"#fff"}),d=["notranslate","material-icons","darken-"+(r?3:1),o.baseClass].join(" ");return i.h("i",{className:d,style:c},r?s:"")}},3149:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Box=void 0;const n=o(6540),i=o(9774),r=o(8711);t.Box=({key:e,size:t,topLeft:o,piece:a,rects:c})=>{let d=[];if(void 0!==a){const i=a.size,l={width:i,height:i};d=((e,t,o,n,i)=>{const s=r.getPieces(t).map((([e,t])=>[e,-t])),a={max:{x:0,y:0},min:{x:0,y:0}};for(const[e,t]of s)a.max.x<e?a.max.x=e:e<a.min.x&&(a.min.x=e),a.max.y<t?a.max.y=t:t<a.min.y&&(a.min.y=t);const c=(a.max.x-a.min.x+1)/2+a.min.x,d=(a.max.y-a.min.y+1)/2+a.min.y,l=e=>e*(n+1)+.5,u=e.x+o.width/2,m=e.y+o.height/2;return s.map((([e,t])=>({x:u+l(e-c),y:m+l(t-d)})))})(o,a.type,t,i).map(((t,o)=>{const i=`${e}-${o}`;return n.h(s,{key:i,dataTest:i,rect:c.pieces[o],size:l,fillColor:a.color,strokeColor:"#333",strokeWidth:0,position:t})}))}const l=void 0!==a?a.type:i.Piece.Empty;return n.h("div",null,n.h(s,{key:e,dataTest:e,rect:c.background,type:l,size:t,fillColor:"#333",strokeColor:"#666",strokeWidth:1,position:o}),d)};const s=({key:e,dataTest:t,rect:o,fillColor:i,position:r,size:s,strokeWidth:a,strokeColor:c,type:d})=>{const l=()=>o.setSize(s),u=()=>o.setAbsolutePosition(r),m=()=>o.fill(i),p=()=>o.stroke(c),g=()=>o.strokeWidth(a),h=()=>o.strokeEnabled(0<a);return n.h("param",{name:"konva",value:e,key:e,datatest:t,type:d,oncreate:()=>{l(),u(),m(),h(),p(),g(),o.show()},onupdate:(e,t)=>{s.width===t.size.width&&s.height===t.size.height||l(),r.x===t.position.x&&r.y===t.position.y||u(),i!==t.color&&m(),c!==t.strokeColor&&p(),a!==t.strokeWidth&&(h(),g())},ondestroy:()=>{o.hide()},color:i,position:r,size:s,strokeColor:c,strokeWidth:a})}},4264:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.comment=void 0;const n=o(4055),i=o(4361);t.comment=({height:e,textColor:t,backgroundColorClass:o,dataTest:r,key:s,id:a,text:c,readonly:d,placeholder:l,currentIndex:u,actions:m})=>{const p=n.style({width:"100%",height:n.px(e),lineHeight:n.px(e),fontSize:n.px(.6*e),boxSizing:"border-box",textAlign:"center",border:"none",color:t});if(d)return i.div({style:n.style({width:"100%",height:n.px(e),whiteSpace:"nowrap"})},[i.input({id:a,key:s,dataTest:r,placeholder:l,value:c,type:"text",className:o,style:p,readonly:"readonly"})]);const g=e=>{if(null!==e.target){const t=e.target;m.updateCommentText({text:t.value,pageIndex:u})}};let h=!0;return i.div({style:n.style({width:"100%",height:n.px(e),whiteSpace:"nowrap"})},[i.input({id:a,key:s,dataTest:r,placeholder:l,oncreate:e=>{e.value=c},onblur:()=>{m.commitCommentText()},onkeydown:e=>{"Enter"===e.key&&(h=e.isComposing)},onkeyup:e=>{e.isComposing||h||"Enter"!==e.key||(e=>{null!==e.target&&e.target.blur()})(e)},oninput:g,onfocus:g,type:"text",className:o,style:p})])}},6100:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawingEventCanvas=void 0;const n=o(6540);o(5917),t.DrawingEventCanvas=({fieldBlocks:e,sentBlocks:t,fieldLayer:o,actions:i})=>n.h("param",{key:"drawing-event-canvas",name:"konva",value:"draw-event-box",oncreate:()=>{const n={mouseOnField:!1,addBodyEvent:!1};e.forEach(((e,t)=>{e.on("touchstart mousedown",(()=>{i.ontouchStartField({index:t})})),e.on("touchmove mouseenter",(()=>{i.ontouchMoveField({index:t})})),e.on("touchend mouseup",(()=>{i.ontouchEnd()}))})),t.forEach(((e,t)=>{e.on("touchstart mousedown",(()=>{i.ontouchStartSentLine({index:t})})),e.on("touchmove mouseenter",(()=>{i.ontouchMoveSentLine({index:t})})),e.on("touchend mouseup",(()=>{i.ontouchEnd()}))})),o.on("touchleave mouseleave",(()=>{n.mouseOnField=!1,n.addBodyEvent||(n.addBodyEvent=!0,document.body.addEventListener("mouseup",(()=>{n.addBodyEvent=!1,n.mouseOnField||i.ontouchEnd()}),{once:!0}))})),o.on("touchenter mouseenter",(()=>{n.mouseOnField=!0}))},ondestroy:()=>{e.forEach((e=>{e.off("touchstart mousedown"),e.off("touchmove mouseenter"),e.off("touchend mouseup")})),t.forEach((e=>{e.off("touchstart mousedown"),e.off("touchmove mouseenter"),e.off("touchend mouseup")})),o.off("touchleave mouseleave"),o.off("touchenter touchenter")}})},5154:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventCanvas=void 0;const n=o(6540);t.EventCanvas=({rect:e,canvas:t,actions:o})=>{const i=()=>e.setSize(t);return n.h("param",{key:"reader-event-canvas",name:"konva",value:"event-box",canvas:t,oncreate:()=>{i(),e.show(),e.on("tap click",o.ontapCanvas)},onupdate:(e,o)=>{t.width===o.canvas.width&&t.height===o.canvas.height||i()},ondestroy:()=>{e.off("tap click"),e.hide()}})}},8174:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0;const n=o(6540),i=o(9774),r=o(3891),s=o(6314);t.Field=({topLeft:e,field:t,sentLine:o,blockSize:d,fieldMarginWidth:l,guideLineColor:u})=>{const m=e.y+22.5*(d+1)+1,p=s.resources.konva.fieldBlocks.map(((o,s)=>{const[c,l]=[s%10,Math.floor(s/10)],m=22-l,p=t[c+10*l],g=`block-${c}-${l}`,h={width:d,height:0!==m?d:d/2},f={x:e.x+c*d+c+1,y:e.y+Math.max(0,m-.5)*d+m+1},y=p.piece===i.Piece.Empty?r.decideBackgroundColor(l):r.decidePieceColor(p.piece,p.highlight,u);return n.h(a,{key:g,dataTest:g,size:h,position:f,color:y,rect:o})})),g=s.resources.konva.sentBlocks.map(((t,i)=>{const[s,c]=[i%10,Math.floor(i/10)],p=o[s+10*c],g=`sent-block-${s}-${c}`,h={width:d,height:d},f={x:e.x+s*d+s+1,y:m+l},y=r.decidePieceColor(p.piece,p.highlight,u);return n.h(a,{key:g,dataTest:g,size:h,position:f,color:y,rect:t})})),h={width:10*(d+1)+1,height:23.5*(d+1)+1+l};return n.h("div",null,n.h(a,{key:"field-bg",dataTest:"field-bg",rect:s.resources.konva.background,size:h,position:e,color:"#333"}),p,n.h(c,{key:"field-margin",dataTest:"field-margin",line:s.resources.konva.fieldMarginLine,width:l,color:"#d8d8d8",start:{x:e.x,y:m+l/2},end:{x:e.x+h.width,y:m+l/2}}),g)};const a=({key:e,dataTest:t,rect:o,color:i,position:r,size:s})=>{const a=()=>o.setSize(s),c=()=>o.setAbsolutePosition(r),d=()=>o.fill(i);return n.h("param",{name:"konva",value:e,key:e,datatest:t,oncreate:()=>{a(),c(),d(),o.show()},onupdate:(e,t)=>{s.width===t.size.width&&s.height===t.size.height||a(),r.x===t.position.x&&r.y===t.position.y||c(),i!==t.color&&d()},ondestroy:()=>{o.hide()},color:i,position:r,size:s})},c=({key:e,dataTest:t,line:o,color:i,width:r,start:s,end:a})=>{const c=()=>o.points([s.x,s.y,a.x,a.y]),d=()=>o.strokeWidth(r),l=()=>o.stroke(i);return n.h("param",{name:"konva",value:e,key:e,datatest:t,oncreate:()=>{c(),d(),l(),o.show()},onupdate:(e,t)=>{s.x===t.start.x&&s.y===t.start.y&&a.x===t.end.x&&a.y===t.end.y||c(),r!==t.width&&d(),i!==t.color&&l()},ondestroy:()=>{o.hide()},color:i,start:s,end:a,width:r})}},4245:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KonvaCanvas=void 0;const n=o(655),i=o(4055),r=o(6314),s=o(6540),a=n.__importDefault(o(185));t.KonvaCanvas=({canvas:e,hyperStage:t,actions:o})=>{const n=i.style({width:i.px(e.width),height:i.px(e.height)});return s.h("div",{canvas:e,id:"canvas-container",style:n,oncreate:n=>{const i=new a.default.Stage({...e,container:n});i.add(r.resources.konva.layers.background),i.add(r.resources.konva.layers.field),i.add(r.resources.konva.layers.boxes),i.add(r.resources.konva.layers.overlay),t.addStage(i),o.refresh()},onupdate:(o,n)=>{e.width===n.canvas.width&&e.height===n.canvas.height||t.resize(e)},ondestroy:()=>{t.removeStage()}})}},1336:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonIconContent=t.Button=t.AppendFumenModal=void 0;const n=o(4055),i=o(6540),r=o(6314),s=o(4257),a=o(8874),c=o(4272);t.AppendFumenModal=({textAreaValue:e,errorMessage:o,actions:c})=>{const d=()=>{r.resources.modals.fumen=void 0},l=()=>{const e=document.getElementById("input-fumen");null!==e&&e.focus()};return i.h("div",{key:"append-fumen-modal-top"},i.h("div",{key:"mdl-append-fumen",datatest:"mdl-append-fumen",className:"modal",oncreate:e=>{const t=M.Modal.init(e,{onOpenEnd:()=>{const e=document.getElementById("input-fumen");null!==e&&e.focus()},onCloseStart:()=>{c.closeAppendModal(),c.clearFumenData(),d()}});t.open(),r.resources.modals.append=t}},i.h("div",{key:"modal-content",className:"modal-content"},i.h("h4",{key:"append-fumen-label",dataTest:"append-fumen-label"},s.i18n.AppendFumen.Title()),i.h(a.TextArea,{key:"input-fumen",dataTest:"input-fumen",id:"input-fumen",placeholder:s.i18n.AppendFumen.PlaceHolder(),error:void 0===o,text:e,actions:{update:({value:e})=>{c.updateFumenData({value:e})}}}),i.h("span",{key:"text-message",datatest:"text-message",className:"red-text text-accent-2",style:n.style({display:void 0!==o?void 0:"none"})},o)),i.h("div",{key:"modal-footer",className:"modal-footer"},i.h("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:()=>{c.closeAppendModal(),c.clearFumenData(),(()=>{const e=r.resources.modals.fumen;void 0!==e&&e.close()})(),d()}},s.i18n.AppendFumen.Buttons.Cancel()),i.h(t.Button,{key:"btn-append-to-next",datatest:"btn-append-to-next",width:85,colorTheme:"red",enable:""!==e&&void 0===o,onclick:()=>(c.commitAppendFumenData({position:"next"}),void l())},i.h(t.ButtonIconContent,{iconSize:20,iconName:"library_add"},"next")),i.h(t.Button,{key:"btn-append-to-end",datatest:"btn-append-to-end",width:85,colorTheme:"red",enable:""!==e&&void 0===o,onclick:()=>(c.commitAppendFumenData({position:"end"}),void l())},i.h(t.ButtonIconContent,{iconSize:20,iconName:"library_add"},"end")))))},t.Button=({href:e="#",key:t,onclick:o,datatest:r,width:s,colorTheme:a,enable:c},d)=>{const l=void 0!==a?`waves-effect waves-light ${a} btn white-text ${c?"":"disabled"}`:"waves-effect waves-teal btn-flat black-text "+(c?"":"disabled");return i.h("a",{href:"#",key:t,datatest:r,className:l,onclick:o,style:n.style({margin:"0px 5px",padding:n.px(5),width:n.px(s),maxWidth:n.px(s),textAlign:"center"})},i.h("div",{style:n.style({width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"})},d))},t.ButtonIconContent=({iconSize:e,iconName:t,textSize:o=13},r)=>i.h("div",{style:n.style({cursor:"pointer"})},i.h("span",{style:n.style({marginRight:n.px(2)})},i.h(c.BlockIcon,{key:"icon",iconSize:e,classNames:["left"]},t)),i.h("span",{style:n.style({fontSize:n.px(o)})},r))},1699:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClipboardIconButton=t.ClipboardButton=t.ClipboardModal=void 0;const n=o(4055),i=o(6540),r=o(6314),s=o(4257),a=o(2315),c=o(8286),d=o(4272);t.ClipboardModal=({actions:e,pages:o})=>{const d=(async()=>`v115@${await a.encode(o)}`)(),l=e=>()=>{let t;d.then((e=>(document.body.setAttribute("datatest","copied-fumen-data"),document.body.setAttribute("data",e),e))).then((t=>`${e}${t}`)).then((e=>{if(t=document.createElement("pre"),!t)throw new c.FumenError("no element");{const o=t.style;o.position="fixed",o.left="-100%",t.textContent=e,document.body.appendChild(t)}const o=document.getSelection();if(null===o)throw new c.FumenError("no selection");if(o.selectAllChildren(t),!document.execCommand("copy"))throw new c.FumenError("command error")})).then((()=>{M.toast({html:"Copied to clipboard",classes:"top-toast",displayLength:1e3})})).catch((e=>{M.toast({html:`Failed to copy: ${e}`,classes:"top-toast",displayLength:1500})})).finally((()=>{t&&document.body.removeChild(t)}))},u=e=>()=>{d.then((t=>`${e}${t}`)).then((e=>{const t=document.querySelector("form[name=clipboard-form]");if(null==t)throw new Error("Not found form element");const o=t.querySelector("input[name=url]");if(null==o)throw new Error("Not found url element");o.value=e,t.submit()})).catch((e=>{M.toast({html:`Failed to open tinyurl: ${e}`,classes:"top-toast",displayLength:1500})}))};return i.h("div",{key:"clipboard-modal-top"},i.h("div",{key:"mdl-clipboard",datatest:"mdl-clipboard",className:"modal",oncreate:t=>{const o=M.Modal.init(t,{onCloseStart:()=>{e.closeClipboardModal()}});o.open(),r.resources.modals.clipboard=o},ondestroy:()=>{const e=r.resources.modals.clipboard;void 0!==e&&e.close(),r.resources.modals.clipboard=void 0}},i.h("div",{key:"modal-content",className:"modal-content"},i.h("h4",{key:"clipboard-label",dataTest:"clipboard-label"},s.i18n.Clipboard.Title()),i.h("div",{style:n.style({margin:"0px auto",padding:"0px",display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"center"})},i.h("form",{name:"clipboard-form",style:n.style({margin:"0px"}),action:"https://tinyurl.com/create.php",method:"get",target:"_blank"},i.h("input",{type:"hidden",name:"url",id:"url",value:"https://knewjade.github.io/fumen-for-mobile/#?d=v115@vhAAgH"}),i.h("div",null,i.h(t.ClipboardButton,{key:"btn-knewjade",onclick:l("https://knewjade.github.io/fumen-for-mobile/#?d=")},"THIS SITE"),i.h(t.ClipboardIconButton,{key:"btn-knewjade-tinyurl",onclick:u("https://knewjade.github.io/fumen-for-mobile/#?d=")},"archive")),i.h("div",null,i.h(t.ClipboardButton,{key:"btn-zui-jp",onclick:l("https://fumen.zui.jp/?")},"FUMEN.ZUI.JP"),i.h(t.ClipboardIconButton,{key:"btn-zui-jp-tinyurl",onclick:u("https://fumen.zui.jp/?")},"archive")),i.h("div",null,i.h(t.ClipboardButton,{key:"btn-harddrop",onclick:l("https://harddrop.com/fumen/?")},"HARDDROP"),i.h(t.ClipboardIconButton,{key:"btn-harddrop-tinyurl",onclick:u("https://harddrop.com/fumen/?")},"archive")),i.h("div",null,i.h(t.ClipboardButton,{key:"btn-raw-fumen",colorName:"white black-text",onclick:l("")},"RAW DATA"))))),i.h("div",{key:"modal-footer",className:"modal-footer"},i.h("a",{href:"#",key:"btn-clipboard-cancel",datatest:"btn-clipboard-cancel",id:"btn-clipboard-cancel",className:"waves-effect waves-teal btn-flat",onclick:()=>{e.closeClipboardModal()}},s.i18n.Clipboard.Buttons.Close()))))},t.ClipboardButton=({key:e,onclick:t,colorName:o="red white-text",padding:r=8,textSize:s=17},a)=>i.h("a",{href:"#",key:e,datatest:e,id:e,fontSize:n.px(s),style:n.style({minWidth:n.px(165),margin:n.px(5),paddingLeft:n.px(r),paddingRight:n.px(r)}),className:`waves-effect waves-light btn ${o}`,onclick:e=>{t(),e.stopPropagation(),e.preventDefault()}},a),t.ClipboardIconButton=({key:e,onclick:t,padding:o=10,textSize:r=20},s)=>{const a=n.style({margin:n.px(5),paddingLeft:n.px(o),paddingRight:n.px(o),cursor:"pointer"});return i.h("a",{href:"#",key:e,datatest:e,id:e,fontSize:n.px(r),style:a,className:"waves-effect waves-light btn white black-text",onclick:e=>{t(),e.stopPropagation(),e.preventDefault()}},i.h(d.BlockIcon,{key:"icon",iconSize:r},s))}},5874:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingButton2=t.SettingButton=t.MenuModal=void 0;const n=o(4055),i=o(6540),r=o(6314),s=o(9774),a=o(4257),c=o(4272),d=o(2315),l=o(8286);t.MenuModal=({version:e,pages:o,screen:c,currentIndex:u,maxPageIndex:m,comment:p,actions:g,state:h})=>{const f=n.style({margin:0,padding:0,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"start",alignItems:"center"}),y=(async()=>`v115@${await d.encode(o)}`)(),v=e=>()=>{y.then((e=>(document.body.setAttribute("datatest","copied-fumen-data"),document.body.setAttribute("data",e),e))).then((t=>`${e}${t}`)).then((e=>{const t=document.createElement("pre");if(null==t)throw new l.FumenError("no element");{const o=t.style;o.position="fixed",o.left="-100%",t.textContent=e,document.body.appendChild(t)}const o=document.getSelection();if(null===o)throw new l.FumenError("no selection");if(o.selectAllChildren(t),!document.execCommand("copy"))throw new l.FumenError("command error");document.body.removeChild(t)})).then((()=>{M.toast({html:"Copied to clipboard",classes:"top-toast",displayLength:600})})).catch((e=>{M.toast({html:`Failed to copy: ${e}`,classes:"top-toast",displayLength:1500})}))};return i.h("div",{key:"menu-modal-top"},i.h("div",{key:"mdl-open-fumen",datatest:"mdl-open-fumen",style:"padding: 0 24px;",oncreate:e=>{},ondestroy:()=>{const e=r.resources.modals.menu;void 0!==e&&e.close(),r.resources.modals.menu=void 0}},i.h("div",{key:"modal-content"},i.h("div",{key:"menu-top",style:f},c===s.Screens.Reader?i.h(t.SettingButton,{key:"btn-writable",datatest:"btn-writable",href:"#",icons:[{name:"mode_edit",size:31.25}],onclick:()=>{g.changeToDrawerScreen({refresh:!0}),g.closeMenuModal()}},a.i18n.Menu.Buttons.Writable()):void 0,i.h(t.SettingButton,{key:"btn-copy-fumen",datatest:"btn-copy-fumen",href:"#",icons:[{name:"content_copy",size:29.3}],onclick:()=>{g.removeUnsettledItems(),g.closeMenuModal(),g.openClipboardModal()}},a.i18n.Menu.Buttons.Clipboard()),i.h(t.SettingButton,{key:"btn-new-fumen",datatest:"btn-new-fumen",href:"#",icons:[{name:"insert_drive_file",size:32.3}],onclick:()=>{g.removeUnsettledItems(),g.loadNewFumen(),g.changeToDrawerScreen({refresh:!0}),g.closeMenuModal()}},a.i18n.Menu.Buttons.New()),i.h(t.SettingButton,{key:"btn-open-fumen",datatest:"btn-open-fumen",href:"#",icons:[{name:"open_in_new",size:32.3}],onclick:()=>{g.removeUnsettledItems(),g.closeMenuModal(),g.openFumenModal()}},a.i18n.Menu.Buttons.Open()),i.h(t.SettingButton,{key:"btn-append-fumen",datatest:"btn-append-fumen",href:"#",icons:[{name:"library_add",size:29}],onclick:()=>{g.closeMenuModal(),g.openAppendModal()}},a.i18n.Menu.Buttons.Append()),i.h(t.SettingButton,{key:"btn-first-page",datatest:"btn-first-page",href:"#",icons:[{name:"fast_rewind",size:32.3}],onclick:()=>{g.firstPage(),g.closeMenuModal()}},a.i18n.Menu.Buttons.FirstPage()),i.h(t.SettingButton,{key:"btn-last-page",datatest:"btn-last-page",href:"#",icons:[{name:"fast_forward",size:32.3}],onclick:()=>{g.lastPage(),g.closeMenuModal()}},a.i18n.Menu.Buttons.LastPage()),i.h(t.SettingButton,{key:"btn-clear-past",datatest:"btn-clear-past",href:"#",icons:[{name:"arrow_back",size:18},{name:"clear",size:28}],textSize:12,enable:0<u,onclick:()=>{g.clearPast(),g.closeMenuModal()}},a.i18n.Menu.Buttons.ClearPast()),i.h(t.SettingButton,{key:"btn-clear-to-end",datatest:"btn-clear-to-end",href:"#",icons:[{name:"clear",size:28},{name:"arrow_forward",size:18}],textSize:12,enable:u<m-1,onclick:()=>{g.clearToEnd(),g.closeMenuModal()}},a.i18n.Menu.Buttons.ClearToEnd()),p!==s.CommentType.PageSlider?i.h(t.SettingButton,{key:"btn-page-slider",href:"#",datatest:"btn-page-slider",icons:[{name:"looks_one",size:30}],onclick:()=>{g.changeCommentMode({type:s.CommentType.PageSlider}),g.closeMenuModal()}},a.i18n.Menu.Buttons.PageSlider()):void 0,c===s.Screens.Reader&&p===s.CommentType.PageSlider?i.h(t.SettingButton,{key:"btn-show-comment",href:"#",datatest:"btn-show-comment",icons:[{name:"text_fields",size:32}],onclick:()=>{g.changeCommentMode({type:s.CommentType.Writable}),g.closeMenuModal()}},a.i18n.Menu.Buttons.ShowComment()):void 0,c===s.Screens.Editor&&p!==s.CommentType.Writable?i.h(t.SettingButton,{key:"btn-comment-writable",href:"#",datatest:"btn-comment-writable",icons:[{name:"text_fields",size:32}],onclick:()=>{g.changeCommentMode({type:s.CommentType.Writable}),g.closeMenuModal()}},a.i18n.Menu.Buttons.WritableComment()):void 0,c===s.Screens.Editor&&p!==s.CommentType.Readonly?i.h(t.SettingButton,{key:"btn-comment-readonly",href:"#",datatest:"btn-comment-readonly",icons:[{name:"lock_outline",size:30}],enable:c===s.Screens.Editor,onclick:c===s.Screens.Editor?()=>{g.changeCommentMode({type:s.CommentType.Readonly}),g.closeMenuModal()}:()=>{M.toast({html:a.i18n.Menu.Messages.NoAvailableCommentButton(),classes:"top-toast",displayLength:3e3})}},a.i18n.Menu.Buttons.ReadonlyComment()):void 0,i.h(t.SettingButton2,{key:"btn-zui-jp",datatest:"btn-zui-jp",href:"#",onclick:()=>{g.removeUnsettledItems(),v("http://fumen.zui.jp/?")()},icons:[{name:"file_copy",size:26}]},"zui.jp"),i.h(t.SettingButton2,{key:"btn-raw-fumen",datatest:"btn-raw-fumen",href:"#",onclick:()=>{g.removeUnsettledItems(),v("")()},icons:[{name:"file_copy",size:26}]},"raw"),i.h("div",{style:n.style({height:n.px(10),width:"100%"})})))))},t.SettingButton=({href:e="#",key:t,onclick:o,icons:r,datatest:s,textSize:a=13,enable:d=!0},l)=>{const u=r.map((e=>i.h(c.Icon,{key:`${t}-icon-${e.name}`,classNames:d?[]:["disabled"],iconSize:e.size},e.name)));return i.h("a",{key:t,href:e,onclick:void 0!==o?e=>{o(e),e.stopPropagation(),e.preventDefault()}:void 0},i.h("div",{key:`${t}-icon`,datatest:s,className:"z-depth-1 "+(d?" ":"disabled"),style:n.style({width:n.px(50),height:n.px(40),lineHeight:n.px(40),display:"flex",alignItems:"center",justifyContent:"center",color:d?"#333":"#bdbdbd",margin:n.px(5),border:"solid 1px "+(d?"#999":"#bdbdbd"),boxSizing:"border-box",cursor:"pointer"})},u),i.h("div",{key:`${t}-text`,style:n.style({textAlign:"center",fontSize:n.px(a),color:d?"#333":"#bdbdbd"})},l))},t.SettingButton2=({href:e="#",key:t,onclick:o,icons:r,datatest:s,textSize:a=13,enable:c=!0},d)=>{const l=r.map((e=>i.h("i",{key:`${t}-icon-${e.name}`,className:"material-icons "+(c?" ":"disabled"),style:n.style({fontSize:n.px(e.size),color:"white"})},e.name)));return i.h("div",null,i.h("a",{key:t,href:e,onclick:void 0!==o?e=>{o(e),e.stopPropagation(),e.preventDefault()}:void 0},i.h("div",{key:`${t}-icon`,datatest:s,className:`waves-effect ${c?" ":"disabled"} teal`,style:n.style({width:n.px(50),height:n.px(40),lineHeight:n.px(40),display:"flex",alignItems:"center",justifyContent:"center",color:c?"#333":"#bdbdbd",margin:n.px(5),boxSizing:"border-box",cursor:"pointer",borderRadius:"2px"})},l)),i.h("div",{key:`${t}-text`,style:n.style({textAlign:"center",fontSize:n.px(a),color:c?"#333":"#bdbdbd"})},d))}},6691:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OpenFumenModal=void 0;const n=o(4055),i=o(6540),r=o(6314),s=o(4257),a=o(8874);t.OpenFumenModal=({textAreaValue:e,errorMessage:t,actions:o})=>{const c="waves-effect waves-light btn red"+(""!==e&&void 0===t?"":" disabled");return i.h("div",{key:"open-fumen-modal-top"},i.h("div",{key:"mdl-open-fumen",datatest:"mdl-open-fumen",oncreate:e=>{},style:"padding: 0 28px;"},i.h("div",{key:"modal-content"},i.h("p",{key:"open-fumen-label",dataTest:"open-fumen-label"},s.i18n.OpenFumen.Title()),i.h(a.TextArea,{key:"input-fumen",dataTest:"input-fumen",id:"input-fumen",placeholder:s.i18n.OpenFumen.PlaceHolder(),error:void 0===t,text:e,actions:{update:({value:e})=>{o.updateFumenData({value:e})}}}),i.h("span",{key:"text-message",datatest:"text-message",className:"red-text text-accent-2",style:n.style({display:void 0!==t?void 0:"none"})},t)),i.h("div",{key:"modal-footer",className:"modal-footer"},i.h("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:()=>{o.closeFumenModal(),o.clearFumenData(),(()=>{const e=r.resources.modals.fumen;void 0!==e&&e.close()})()}},s.i18n.OpenFumen.Buttons.Cancel()),i.h("a",{href:"#",key:"btn-open",datatest:"btn-open",id:"btn-open",className:c,onclick:()=>{o.commitOpenFumenData(),(()=>{const e=document.getElementById("input-fumen");null!==e&&e.focus()})()}},s.i18n.OpenFumen.Buttons.Open()))))}},8874:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextArea=void 0;const n=o(4055),i=o(4361);t.TextArea=({id:e,key:t,dataTest:o,placeholder:r,error:s,text:a,actions:c})=>{const d=n.style({width:"100%",border:s?void 0:"solid 1px #ff5252"}),l=e=>{if(null!==e.target){const t=e.target;c.update({value:t.value})}};let u=!0;return i.textarea({id:e,key:t,dataTest:o,placeholder:r,oncreate:e=>{e.value=a},onkeydown:e=>{"Enter"===e.key&&(u=e.isComposing)},onkeyup:e=>{e.isComposing||u||"Enter"!==e.key||(e=>{null!==e.target&&e.target.blur()})(e)},oninput:l,onfocus:l,rows:3,style:d})}},3175:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserSettingsModal=void 0;const n=o(4055),i=o(6540),r=o(6314),s=o(4257);t.UserSettingsModal=({ghostVisible:e,loop:t,actions:o})=>i.h("div",{key:"user-settings-modal-top"},i.h("div",{key:"mdl-user-settings",datatest:"mdl-user-settings",className:"modal",oncreate:e=>{const t=M.Modal.init(e,{onCloseStart:()=>{o.closeUserSettingsModal()}});o.copyUserSettingsToTemporary(),t.open(),r.resources.modals.userSettings=t},ondestroy:()=>{const e=r.resources.modals.userSettings;void 0!==e&&e.close(),r.resources.modals.userSettings=void 0}},i.h("div",{key:"modal-content",className:"modal-content"},i.h("h4",null,s.i18n.UserSettings.Title()),i.h("div",{style:n.style({color:"#666"})},s.i18n.UserSettings.Notice()),i.h("div",{style:n.style({color:"#333",marginTop:n.px(15)})},i.h("div",{class:"switch"},i.h("h6",null,s.i18n.UserSettings.Ghost.Title()),i.h("label",null,s.i18n.UserSettings.Ghost.Off(),i.h("input",{type:"checkbox",dataTest:"switch-ghost-visible",onupdate:t=>{t.checked!==e&&(t.checked=e)},onchange:e=>{if(!e||!e.target)return;const t=e.target;o.keepGhostVisible({visible:t.checked})}}),i.h("span",{class:"lever"}),s.i18n.UserSettings.Ghost.On())),i.h("div",{class:"switch"},i.h("h6",null,s.i18n.UserSettings.Loop.Title()),i.h("label",null,s.i18n.UserSettings.Loop.Off(),i.h("input",{type:"checkbox",dataTest:"switch-loop",onupdate:e=>{e.checked!==t&&(e.checked=t)},onchange:e=>{if(!e||!e.target)return;const t=e.target;o.keepLoop({enable:t.checked})}}),i.h("span",{class:"lever"}),s.i18n.UserSettings.Loop.On())))),i.h("div",{key:"modal-footer",className:"modal-footer"},i.h("a",{href:"#",key:"btn-cancel",datatest:"btn-cancel",id:"btn-cancel",className:"waves-effect waves-teal btn-flat",onclick:()=>{o.closeUserSettingsModal()}},s.i18n.UserSettings.Buttons.Cancel()),i.h("a",{href:"#",key:"btn-save",datatest:"btn-save",id:"btn-save",className:"waves-effect waves-light btn red",onclick:()=>{o.commitUserSettings(),o.closeUserSettingsModal()}},s.i18n.UserSettings.Buttons.Save()))))},37:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.page_slider=void 0;const n=o(4361),i=o(4055);t.page_slider=({datatest:e,size:t,maxPage:o,currentIndex:r,actions:s})=>n.div({className:"range-field",style:i.style({width:i.px(t.width),height:i.px(t.height),margin:"0px auto"})},[n.input({oninput:()=>{const e=document.getElementById("input-page-number");if(null!==e){const t=Number(e.value);s.openPageWhenChange({index:t-1})}},datatest:e,id:"input-page-number",type:"range",min:"1",max:`${o}`,value:`${r+1}`})])},1809:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorTools=void 0;const n=o(4055),i=o(6540),r=o(3136),s=o(7478),a=o(9774);t.EditorTools=({currentPage:e,maxPage:t,height:o,palette:c,modeType:d,undoCount:l,redoCount:u,inferenceCount:m,actions:p})=>{const g=n.style({width:"100%",height:n.px(o),margin:0,padding:0}),h=n.style({width:"100%",height:n.px(o),margin:0,padding:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),f={baseClass:c.baseClass,baseCode:c.baseCode,darkCode:c.darkCode},y=`page-footer tools ${c.baseClass}`,v=`${e} / ${t}`,x=e<t?"navigate_next":"add";return i.h("nav",{datatest:"tools",className:y,style:g},i.h("div",{className:"nav-wrapper",style:h},i.h(r.ToolButton,{iconName:"undo",datatest:"btn-undo",width:35,height:o-10,key:"btn-undo",fontSize:33.75,marginRight:5,colors:f,actions:{onclick:()=>p.undo()},enable:0<l||0<m}),i.h(r.ToolButton,{iconName:"redo",datatest:"btn-redo",width:35,height:o-10,key:"btn-redo",fontSize:33.75,marginRight:15,colors:f,actions:{onclick:()=>p.redo()},enable:0<u}),i.h(r.ToolButton,{iconName:"navigate_before",datatest:"btn-back-page",width:35,height:o-10,key:"btn-back-page",fontSize:33.75,marginRight:5,colors:f,actions:{onclick:()=>p.backPage({loop:!1})},enable:1<e}),i.h(s.ToolText,{datatest:"text-pages",height:o-10,minWidth:75,fontSize:18,marginRight:5},v),i.h(r.ToolButton,{iconName:x,datatest:"btn-next-page",width:35,height:o-10,key:"btn-next-page",fontSize:33.75,marginRight:10,colors:f,actions:{onclick:()=>p.nextPageOrNewPage()}}),i.h(r.ToolButton,{iconName:"home",datatest:"btn-drawing-tool",width:40,height:o-10,key:"btn-drawing-tool",fontSize:30,marginRight:40,colors:f,actions:{onclick:()=>p.changeToDrawingToolMode()},enable:d!==a.ModeTypes.DrawingTool}),i.h(r.ToolButton,{iconName:"menu",datatest:"btn-open-menu",sticky:!0,key:"btn-open-menu",width:40,height:o-10,fontSize:32,colors:f,actions:{onclick:()=>p.openMenuModal()}})))}},6136:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReaderTools=void 0;const n=o(4055),i=o(6540),r=o(3136),s=o(7478),a=o(9774);t.ReaderTools=({currentPage:e,maxPage:t,height:o,animationState:c,pages:d,palette:l,loop:u,actions:m})=>{const p=n.style({width:"100%",height:n.px(o),margin:0,padding:0}),g=n.style({width:"100%",height:n.px(o),margin:0,padding:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),h=`page-footer tools ${l.baseClass}`;return i.h("nav",{datatest:"tools",className:h,style:p},i.h("div",{className:"nav-wrapper",style:g},i.h(r.ToolButton,{iconName:"pause"!==c?"pause":"play_arrow",datatest:"btn-play-anime",key:"btn-play-anime",width:40,height:o-10,fontSize:40,colors:l,marginRight:15,actions:{onclick:()=>{switch(c){case a.AnimationState.Play:m.pauseAnimation();break;default:m.startAnimation()}}}}),i.h(r.ToolButton,{iconName:"navigate_before",datatest:"btn-back-page",width:35,height:o-10,key:"btn-back-page",fontSize:33.75,marginRight:5,colors:l,actions:{onclick:()=>m.backPage({loop:u})},enable:u||1<e}),i.h(s.ToolText,{datatest:"text-pages",height:o-10,minWidth:75,fontSize:18,marginRight:5},d),i.h(r.ToolButton,{iconName:"navigate_next",datatest:"btn-next-page",width:35,height:o-10,key:"btn-next-page",fontSize:33.75,marginRight:10,colors:l,enable:u||e<t,actions:{onclick:()=>m.nextPage({loop:u})}}),i.h(r.ToolButton,{iconName:"mode_edit",datatest:"btn-writable-in-reader",width:40,height:o-10,key:"btn-writable-in-reader",fontSize:33.75,marginRight:10,colors:l,actions:{onclick:()=>{m.changeToDrawerScreen({refresh:!0})}}}),i.h(r.ToolButton,{iconName:"menu",datatest:"btn-open-menu",sticky:!0,key:"btn-open-menu",width:40,height:o-10,fontSize:32,colors:l,actions:{onclick:()=>m.openMenuModal()}})))}},3136:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolButton=void 0;const n=o(6540),i=o(4055),r=o(4272);t.ToolButton=({height:e,width:t,fontSize:o,key:s,iconName:a,sticky:c=!1,marginLeft:d,marginRight:l=0,datatest:u,colors:m,enable:p=!0,actions:g})=>{const h=i.style({height:i.px(e),lineHeight:i.px(e),width:i.px(t),marginLeft:c?"auto":d,position:c?"absolute":void 0,right:c?"10px":void 0,marginRight:i.px(l)}),f=g.onclick;return n.h("a",{href:"#",key:s,datatest:u,style:h,onclick:void 0!==f?e=>{f(e),e.stopPropagation(),e.preventDefault()}:void 0},n.h(r.SizedIcon,{height:e,fontSize:o,colors:m,enable:p},a))}},7478:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolText=void 0;const n=o(6540),i=o(4055);t.ToolText=({datatest:e,height:t,fontSize:o,minWidth:r,marginRight:s=0},a)=>{const c=i.style({lineHeight:i.px(t),fontSize:i.px(o),minWidth:i.px(r),textAlign:"center",whiteSpace:"nowrap",marginRight:i.px(s)});return n.h("span",{datatest:e,style:c},a)}},2995:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toPage=t.toPrimitivePage=t.toDecoratorOperationTask=t.toPageTaskStack=t.toUnsetQuizFlagTask=t.toSetQuizFlagTask=t.toUnfreezeCommentTask=t.toFreezeCommentTask=t.toRefPageTask=t.toKeyPageTask=t.toInsertPageTask=t.toRemovePageTask=t.toSinglePageTask=t.toFumenTask=t.isOperationTask=void 0;const n=o(1983),i=o(5187),r=o(2315),s=o(9782);t.isOperationTask=function(e){return!e.fixed},t.toFumenTask=(e,o,n)=>({replay:async()=>({pages:await r.decode(o),index:0}),revert:async()=>({pages:e.map(t.toPage),index:n}),fixed:!0,key:i.generateKey()}),t.toSinglePageTask=(e,o,n)=>{const r=t.toPrimitivePage(n);return{replay:o=>(o[e]=t.toPage(r),{pages:o,index:e}),revert:n=>(n[e]=t.toPage(o),{pages:n,index:e}),fixed:!1,key:i.generateKey()}},t.toRemovePageTask=(e,o,r,s)=>({replay:t=>{const i=new n.Pages(t);i.deletePage(e,o);const r=i.pages;return{pages:r,index:e<r.length?e:r.length-1}},revert:o=>{const i=new n.Pages(o);return i.insertPage(e,r.map(t.toPage)),{pages:i.pages,index:s}},fixed:!1,key:i.generateKey()}),t.toInsertPageTask=(e,o,r)=>({replay:i=>{const r=new n.Pages(i);return r.insertPage(e,o.map(t.toPage)),{pages:r.pages,index:e}},revert:t=>{const i=new n.Pages(t);return i.deletePage(e,e+o.length),{pages:i.pages,index:r}},fixed:!1,key:i.generateKey()}),t.toKeyPageTask=e=>({replay:t=>{const o=new n.Pages(t);return o.toKeyPage(e),{index:e,pages:o.pages}},revert:t=>{const o=new n.Pages(t);return o.toRefPage(e),{index:e,pages:o.pages}},fixed:!1,key:i.generateKey()}),t.toRefPageTask=e=>({replay:t=>{const o=new n.Pages(t);return o.toRefPage(e),{index:e,pages:o.pages}},revert:t=>{const o=new n.Pages(t);return o.toKeyPage(e),{index:e,pages:o.pages}},fixed:!1,key:i.generateKey()}),t.toFreezeCommentTask=e=>({replay:t=>{const o=new n.Pages(t);return o.freezeComment(e),{index:e,pages:o.pages}},revert:t=>{const o=new n.Pages(t);return o.unfreezeComment(e),{index:e,pages:o.pages}},fixed:!1,key:i.generateKey()}),t.toUnfreezeCommentTask=(e,t)=>({replay:t=>{const o=new n.Pages(t);return o.unfreezeComment(e),{index:e,pages:o.pages}},revert:o=>{const i=new n.Pages(o);i.freezeComment(e);const r=i.pages;return r[e].comment={text:t},{index:e,pages:r}},fixed:!1,key:i.generateKey()}),t.toSetQuizFlagTask=e=>({replay:t=>{const o=new n.Pages(t);return o.setQuizFlag(e),{index:e,pages:o.pages}},revert:t=>{const o=new n.Pages(t);return o.unsetQuizFlag(e),{index:e,pages:o.pages}},fixed:!1,key:i.generateKey()}),t.toUnsetQuizFlagTask=e=>({replay:t=>{const o=new n.Pages(t);return o.unsetQuizFlag(e),{index:e,pages:o.pages}},revert:t=>{const o=new n.Pages(t);return o.setQuizFlag(e),{index:e,pages:o.pages}},fixed:!1,key:i.generateKey()}),t.toPageTaskStack=(e,t)=>({replay:t=>{let o={pages:t,index:0};for(const t of e)o=t.replay(o.pages);return o},revert:o=>{let n={pages:o,index:0};for(const t of e.concat().reverse())n=t.revert(n.pages);return{pages:n.pages,index:void 0!==t?t:n.index}},fixed:!1,key:i.generateKey()}),t.toDecoratorOperationTask=(e,t)=>({replay:o=>{const n=e.replay(o);return t.replay(n.pages)},revert:o=>{const n=t.revert(o);return e.revert(n.pages)},fixed:!1,key:e.key}),t.toPrimitivePage=e=>{const t=e.field.obj,o=e.commands;return{index:e.index,field:{obj:void 0!==t?{play:t.toPlayFieldPieces(),sentLine:t.toSentLintPieces()}:void 0,ref:e.field.ref},piece:void 0!==e.piece?{type:e.piece.type,coordinate:{...e.piece.coordinate},rotation:e.piece.rotation}:void 0,comment:{text:e.comment.text,ref:e.comment.ref},commands:void 0!==o?{pre:{...o.pre}}:void 0,flags:{lock:e.flags.lock,mirror:e.flags.mirror,colorize:e.flags.colorize,rise:e.flags.rise,quiz:e.flags.quiz}}},t.toPage=e=>{const t=e.field.obj,o=e.commands;return{index:e.index,field:{obj:void 0!==t?new s.Field({field:new s.PlayField({pieces:t.play}),sentLine:new s.PlayField({pieces:t.sentLine})}):void 0,ref:e.field.ref},piece:e.piece,comment:{text:e.comment.text,ref:e.comment.ref},commands:void 0!==o?{pre:{...o.pre}}:void 0,flags:{lock:e.flags.lock,mirror:e.flags.mirror,colorize:e.flags.colorize,rise:e.flags.rise,quiz:e.flags.quiz}}}},3891:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decideBackgroundColor=t.decidePieceColor=t.Palette=void 0;const n=o(9774),i=o(2742);t.Palette=e=>({baseClass:(()=>{switch(e){case n.Screens.Editor:return"red";default:return"teal"}})(),baseCode:(()=>{switch(e){case n.Screens.Editor:return"#f44336";default:return"#009688"}})(),darkCode:(()=>{switch(e){case n.Screens.Editor:return"#d32f2f";default:return"#00796b"}})()}),t.decidePieceColor=function(e,t,o){return(o?r:s)[e][void 0!==t?t:i.HighlightType.Normal]};const r={inference:{[i.HighlightType.Normal]:"#ffffff",[i.HighlightType.Highlight1]:"#ffffff",[i.HighlightType.Highlight2]:"#ffffff",[i.HighlightType.Lighter]:"#ffffff"},[n.Piece.Gray]:{[i.HighlightType.Normal]:"#999999",[i.HighlightType.Highlight1]:"#cccccc",[i.HighlightType.Highlight2]:"#ffffff",[i.HighlightType.Lighter]:"#333333"},[n.Piece.I]:{[i.HighlightType.Normal]:"#009999",[i.HighlightType.Highlight1]:"#33cccc",[i.HighlightType.Highlight2]:"#00ffff",[i.HighlightType.Lighter]:"#003333"},[n.Piece.T]:{[i.HighlightType.Normal]:"#990099",[i.HighlightType.Highlight1]:"#cc33cc",[i.HighlightType.Highlight2]:"#ff00ff",[i.HighlightType.Lighter]:"#4d004d"},[n.Piece.S]:{[i.HighlightType.Normal]:"#009900",[i.HighlightType.Highlight1]:"#33cc33",[i.HighlightType.Highlight2]:"#00ff00",[i.HighlightType.Lighter]:"#003300"},[n.Piece.Z]:{[i.HighlightType.Normal]:"#990000",[i.HighlightType.Highlight1]:"#cc3333",[i.HighlightType.Highlight2]:"#ff0000",[i.HighlightType.Lighter]:"#4d0000"},[n.Piece.L]:{[i.HighlightType.Normal]:"#996600",[i.HighlightType.Highlight1]:"#cc9933",[i.HighlightType.Highlight2]:"#ff9900",[i.HighlightType.Lighter]:"#3b1d00"},[n.Piece.J]:{[i.HighlightType.Normal]:"#0000BB",[i.HighlightType.Highlight1]:"#3333cc",[i.HighlightType.Highlight2]:"#0000ff",[i.HighlightType.Lighter]:"#000061"},[n.Piece.O]:{[i.HighlightType.Normal]:"#999900",[i.HighlightType.Highlight1]:"#cccc33",[i.HighlightType.Highlight2]:"#ffff00",[i.HighlightType.Lighter]:"#333300"},[n.Piece.Empty]:{[i.HighlightType.Normal]:"#000000",[i.HighlightType.Highlight1]:"#000000",[i.HighlightType.Highlight2]:"#000000",[i.HighlightType.Lighter]:"#000000"}},s={inference:r.inference,[n.Piece.Gray]:r[n.Piece.Gray],[n.Piece.I]:r[n.Piece.Z],[n.Piece.T]:r[n.Piece.I],[n.Piece.S]:r[n.Piece.T],[n.Piece.Z]:r[n.Piece.S],[n.Piece.L]:r[n.Piece.L],[n.Piece.J]:r[n.Piece.J],[n.Piece.O]:r[n.Piece.O],[n.Piece.Empty]:r[n.Piece.Empty]};t.decideBackgroundColor=e=>e<20?"#000000":"#333333"},9774:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isInPlayField=t.parseRotationName=t.nextRotationToRight=t.nextRotationToLeft=t.toPositionIndex=t.isMinoPiece=t.parsePiece=t.parsePieceName=t.Platforms=t.CommentType=t.TouchTypes=t.ModeTypes=t.Screens=t.FieldConstants=t.Action=t.Operation=t.AnimationState=t.Rotation=t.Piece=void 0;const n=o(8286);var i,r,s,a,c,d,l,u,m,p;!function(e){e[e.Empty=0]="Empty",e[e.I=1]="I",e[e.L=2]="L",e[e.O=3]="O",e[e.Z=4]="Z",e[e.T=5]="T",e[e.J=6]="J",e[e.S=7]="S",e[e.Gray=8]="Gray"}(i=t.Piece||(t.Piece={})),function(e){e[e.Spawn=0]="Spawn",e[e.Right=1]="Right",e[e.Reverse=2]="Reverse",e[e.Left=3]="Left"}(r=t.Rotation||(t.Rotation={})),(p=t.AnimationState||(t.AnimationState={})).Pause="pause",p.Play="play",(m=t.Operation||(t.Operation={})).Direct="direct",m.Swap="swap",m.Stock="stock",(t.Action||(t.Action={})).Block="block",function(e){e[e.Width=10]="Width",e[e.Height=23]="Height",e[e.SentLine=1]="SentLine",e[e.PlayBlocks=230]="PlayBlocks",e[e.AllBlocks=240]="AllBlocks"}(s=t.FieldConstants||(t.FieldConstants={})),(u=t.Screens||(t.Screens={})).Reader="Reader",u.Editor="Editor",(l=t.ModeTypes||(t.ModeTypes={})).Drawing="Drawing",l.Piece="Piece",l.Fill="Fill",l.DrawingTool="DrawingTool",l.Flags="Flags",l.Utils="Utils",l.Slide="Slide",l.FillRow="FillRow",l.SelectPiece="SelectPiece",l.Comment="Comment",(d=t.TouchTypes||(t.TouchTypes={})).None="None",d.Drawing="Drawing",d.Piece="Piece",d.Fill="Fill",d.MovePiece="MovePiece",d.FillRow="FillRow",(c=t.CommentType||(t.CommentType={})).Writable="Writable",c.Readonly="Readonly",c.PageSlider="PageSlider",(a=t.Platforms||(t.Platforms={})).PC="PC",a.Mobile="Mobile",t.parsePieceName=function(e){switch(e){case i.I:return"I";case i.L:return"L";case i.O:return"O";case i.Z:return"Z";case i.T:return"T";case i.J:return"J";case i.S:return"S";case i.Gray:return"Gray";case i.Empty:return"Empty"}},t.parsePiece=function(e){switch(e.toUpperCase()){case"I":return i.I;case"L":return i.L;case"O":return i.O;case"Z":return i.Z;case"T":return i.T;case"J":return i.J;case"S":return i.S;case"X":return i.Gray;case" ":case"_":return i.Empty}throw new n.FumenError(`Unexpected piece: ${e}`)},t.isMinoPiece=function(e){return e!==i.Empty&&e!==i.Gray},t.toPositionIndex=function(e){return e[0]+10*e[1]},t.nextRotationToLeft=function(e){switch(e){case r.Spawn:return r.Left;case r.Left:return r.Reverse;case r.Reverse:return r.Right;case r.Right:return r.Spawn}},t.nextRotationToRight=function(e){switch(e){case r.Spawn:return r.Right;case r.Right:return r.Reverse;case r.Reverse:return r.Left;case r.Left:return r.Spawn}},t.parseRotationName=function(e){switch(e){case r.Spawn:return"Spawn";case r.Left:return"Left";case r.Right:return"Right";case r.Reverse:return"Reverse"}},t.isInPlayField=function(e,t){return 0<=e&&e<s.Width&&0<=t&&t<s.Height}},8286:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ViewError=t.FumenError=void 0;class o{constructor(e){this.message=e,this.name=this.constructor.name,Object.setPrototypeOf(this,this.constructor.prototype)}toString(){return`${this.name}: ${this.message}`}}t.FumenError=class extends o{constructor(e){super(e)}},t.ViewError=class extends o{constructor(e){super(e)}}},2534:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encodeAction=t.decodeAction=void 0;const n=o(8286),i=o(9774);function r(e){return 0!==e}function s(e){return e?1:0}t.decodeAction=function(e,t){const o=(t+i.FieldConstants.SentLine)*i.FieldConstants.Width;let s=e;const a=function(e){switch(e){case 0:return i.Piece.Empty;case 1:return i.Piece.I;case 2:return i.Piece.L;case 3:return i.Piece.O;case 4:return i.Piece.Z;case 5:return i.Piece.T;case 6:return i.Piece.J;case 7:return i.Piece.S;case 8:return i.Piece.Gray}throw new n.FumenError("Unexpected piece")}(s%8);s=Math.floor(s/8);const c=function(e){switch(e){case 0:return i.Rotation.Reverse;case 1:return i.Rotation.Right;case 2:return i.Rotation.Spawn;case 3:return i.Rotation.Left}throw new n.FumenError("Unexpected rotation")}(s%4);s=Math.floor(s/4);const d=function(e,t,o,n){let r=e%i.FieldConstants.Width;let s=n-Math.floor(e/10)-1;return t===i.Piece.O&&o===i.Rotation.Left?(r+=1,s-=1):t===i.Piece.O&&o===i.Rotation.Reverse?r+=1:t===i.Piece.O&&o===i.Rotation.Spawn?s-=1:t===i.Piece.I&&o===i.Rotation.Reverse?r+=1:t===i.Piece.I&&o===i.Rotation.Left||t===i.Piece.S&&o===i.Rotation.Spawn?s-=1:t===i.Piece.S&&o===i.Rotation.Right?r-=1:t===i.Piece.Z&&o===i.Rotation.Spawn?s-=1:t===i.Piece.Z&&o===i.Rotation.Left&&(r+=1),{x:r,y:s}}(s%o,a,c,t);s=Math.floor(s/o);const l=r(s%2);s=Math.floor(s/2);const u=r(s%2);s=Math.floor(s/2);const m=r(s%2);s=Math.floor(s/2);const p=r(s%2);return s=Math.floor(s/2),{rise:l,mirror:u,colorize:m,comment:p,lock:!r(s%2),piece:{type:a,rotation:c,coordinate:d}}},t.encodeAction=function(e){const{lock:t,comment:o,colorize:n,mirror:r,rise:a,piece:c}=e;let d=s(!t);return d*=2,d+=s(o),d*=2,d+=s(n),d*=2,d+=s(r),d*=2,d+=s(a),d*=i.FieldConstants.AllBlocks,d+=function({coordinate:e,type:t,rotation:o}){let{x:n,y:r}=e;return i.isMinoPiece(t)?t===i.Piece.O&&o===i.Rotation.Left?(n-=1,r+=1):t===i.Piece.O&&o===i.Rotation.Reverse?n-=1:t===i.Piece.O&&o===i.Rotation.Spawn?r+=1:t===i.Piece.I&&o===i.Rotation.Reverse?n-=1:t===i.Piece.I&&o===i.Rotation.Left||t===i.Piece.S&&o===i.Rotation.Spawn?r+=1:t===i.Piece.S&&o===i.Rotation.Right?n+=1:t===i.Piece.Z&&o===i.Rotation.Spawn?r+=1:t===i.Piece.Z&&o===i.Rotation.Left&&(n-=1):(n=0,r=22),(i.FieldConstants.Height-r-1)*i.FieldConstants.Width+n}(c),d*=4,d+=function({type:e,rotation:t}){if(!i.isMinoPiece(e))return 0;switch(t){case i.Rotation.Reverse:return 0;case i.Rotation.Right:return 1;case i.Rotation.Spawn:return 2;case i.Rotation.Left:return 3}}(c),d*=8,d+=c.type,d}},9782:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayField=t.Field=void 0;const n=o(9774),i=o(8286),r=o(8711);class s{constructor({field:e=s.create(n.FieldConstants.PlayBlocks),sentLine:t=s.create(n.FieldConstants.Width)}){this.playField=e,this.sentLine=t}static create(e){return new a({length:e})}add(e,t,o){0<=t?this.playField.add(e,t,o):this.sentLine.add(e,-(t+1),o)}put(e){this.playField.put(e)}deleteAt(e){this.playField.setAt(e,n.Piece.Empty)}setToPlayField(e,t){this.playField.setAt(e,t)}setToSentLine(e,t){this.sentLine.setAt(e,t)}clearLine(){this.playField.clearLine()}up(){this.playField.up(this.sentLine),this.sentLine.clearAll()}mirror(){this.playField.mirror()}shiftToLeft(){this.playField.shiftToLeft()}shiftToRight(){this.playField.shiftToRight()}shiftToUp(){this.playField.shiftToUp()}shiftToBottom(){this.playField.shiftToBottom()}get(e,t){return 0<=t?this.playField.get(e,t):this.sentLine.get(e,-(t+1))}getAtIndex(e,t){return t?this.get(e%10,Math.floor(e/10)):this.get(e%10,-(Math.floor(e/10)+1))}copy(){return new s({field:this.playField.copy(),sentLine:this.sentLine.copy()})}toPlayFieldPieces(){return this.playField.toArray()}toSentLintPieces(){return this.sentLine.toArray()}equals(e){return this.playField.equals(e.playField)&&this.sentLine.equals(e.sentLine)}canPut(e,t,o,i){return r.getBlockPositions(e,t,o,i).every((([e,t])=>0<=e&&e<10&&0<=t&&this.get(e,t)===n.Piece.Empty))}isOnGround(e,t,o,n){return!this.canPut(e,t,o,n-1)}convertToGray(){this.playField.convertToGray(),this.sentLine.convertToGray()}}t.Field=s;class a{constructor({pieces:e,length:t=n.FieldConstants.PlayBlocks}){this.pieces=void 0!==e?e:Array.from({length:t}).map((()=>n.Piece.Empty)),this.length=t}static load(...e){const t=e.join("").trim();return a.loadInner(t)}static loadMinify(...e){const t=e.join("").trim();return a.loadInner(t,t.length)}static loadInner(e,t){const o=void 0!==t?t:e.length;if(o%10!=0)throw new i.FumenError("Num of block in field should be mod 10");const r=new a(void 0!==t?{length:t}:{});for(let t=0;t<o;t+=1){const i=e[t];r.set(t%10,Math.floor((o-t-1)/10),n.parsePiece(i))}return r}get(e,t){return this.pieces[e+t*n.FieldConstants.Width]}add(e,t,o){const i=e+t*n.FieldConstants.Width;this.pieces[i]=Math.max(this.pieces[i]+o,0)}set(e,t,o){this.setAt(e+t*n.FieldConstants.Width,o)}setAt(e,t){this.pieces[e]=t}put({type:e,rotation:t,coordinate:o}){const n=r.getBlocks(e,t);for(const t of n){const[n,i]=[o.x+t[0],o.y+t[1]];this.set(n,i,e)}}clearLine(){let e=this.pieces.concat();for(let t=this.pieces.length/n.FieldConstants.Width-1;0<=t;t-=1)if(this.pieces.slice(t*n.FieldConstants.Width,(t+1)*n.FieldConstants.Width).every((e=>e!==n.Piece.Empty))){const o=e.slice(0,t*n.FieldConstants.Width),i=e.slice((t+1)*n.FieldConstants.Width);e=o.concat(i,Array.from({length:n.FieldConstants.Width}).map((()=>n.Piece.Empty)))}this.pieces=e}up(e){this.pieces=e.pieces.concat(this.pieces).slice(0,this.length)}mirror(){const e=[];for(let t=0;t<this.pieces.length;t+=1){const o=this.pieces.slice(t*n.FieldConstants.Width,(t+1)*n.FieldConstants.Width);o.reverse();for(const t of o)e.push(t)}this.pieces=e}shiftToLeft(){const e=this.pieces.length/10;for(let t=0;t<e;t+=1){for(let e=0;e<n.FieldConstants.Width-1;e+=1)this.pieces[e+t*n.FieldConstants.Width]=this.pieces[e+1+t*n.FieldConstants.Width];this.pieces[9+t*n.FieldConstants.Width]=n.Piece.Empty}}shiftToRight(){const e=this.pieces.length/10;for(let t=0;t<e;t+=1){for(let e=n.FieldConstants.Width-1;1<=e;e-=1)this.pieces[e+t*n.FieldConstants.Width]=this.pieces[e-1+t*n.FieldConstants.Width];this.pieces[t*n.FieldConstants.Width]=n.Piece.Empty}}shiftToUp(){const e=Array.from({length:10}).map((()=>n.Piece.Empty));this.pieces=e.concat(this.pieces).slice(0,this.length)}shiftToBottom(){const e=Array.from({length:10}).map((()=>n.Piece.Empty));this.pieces=this.pieces.slice(10,this.length).concat(e)}toArray(){return this.pieces.concat()}get numOfBlocks(){return this.pieces.length}copy(){return new a({pieces:this.pieces.concat(),length:this.length})}toShallowArray(){return this.pieces}clearAll(){this.pieces=this.pieces.map((()=>n.Piece.Empty))}equals(e){if(this.pieces.length!==e.pieces.length)return!1;for(let t=0;t<this.pieces.length;t+=1)if(this.pieces[t]!==e.pieces[t])return!1;return!0}convertToGray(){this.pieces=this.pieces.map((e=>e!==n.Piece.Empty?n.Piece.Gray:n.Piece.Empty))}}t.PlayField=a},2315:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.innerDecode=t.decode=t.extract=void 0;const n=o(9774),i=o(4826),r=o(9782),s=o(2534),a=o(2375),c=o(8286),d=o(1983),l=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",u=l.length+1;function m(e){const t=[];let o=e;for(let e=0;e<4;e+=1){const e=o%u;t.push(l[e]),o=Math.floor(o/u)}return t}const p=n.FieldConstants.Width;function g(e){const t=(e,t)=>({version:e,data:t.trim().replace(/[?\s]+/g,"")});let o=e;const n=o.indexOf("&");0<=n&&(o=o.substring(0,n));{const n=e.match(/[vmd]115@/);if(null!=n&&void 0!==n.index)return t("115",o.substr(n.index+5))}{const n=e.match(/[vmd]110@/);if(null!=n&&void 0!==n.index)return t("110",o.substr(n.index+5))}throw new c.FumenError("Fumen is not supported")}async function h(e,t,o=(()=>{})){const c=(t+n.FieldConstants.SentLine)*p,d=e=>{const o={changed:!1,field:e};let n=0;for(;n<c;){const e=u.poll(2),i=Math.floor(e/c),r=e%c;r!==c-1&&(o.changed=!0);for(let e=0;e<r+1;e+=1){const e=n%p,r=t-Math.floor(n/p)-1;o.field.add(e,r,i-8),n+=1}}return o};let l=0;const u=new a.Values(e);let g=new r.Field({});const h={repeatCount:-1,refIndex:{comment:0,field:0},quiz:void 0,lastCommentText:""},f=[];for(;!u.isEmpty();){let e;0<h.repeatCount?(e={field:g,changed:!1},h.repeatCount-=1):(e=d(g.copy()),e.changed||(h.repeatCount=u.poll(1)));const r=u.poll(3),a=s.decodeAction(r,t);let c;if(a.comment){const e=[],t=u.poll(2);for(let o=0;o<Math.floor((t+3)/4);o+=1){const t=u.poll(5);e.push(t)}const o=[];for(const t of e){const e=m(t);o.push(...e)}const n=unescape(o.slice(0,t).join(""));h.lastCommentText=n,c={text:n},h.refIndex.comment=l;const r=c.text;if(i.Quiz.isQuizComment(r))try{h.quiz=new i.Quiz(r)}catch(e){h.quiz=void 0}else h.quiz=void 0}else c=0===l?{text:""}:{ref:h.refIndex.comment};let p,y,v=!1;if(void 0!==h.quiz&&(v=!0,h.quiz.canOperate()&&a.lock))if(n.isMinoPiece(a.piece.type))try{const e=h.quiz.nextIfEnd(),t=e.getOperation(a.piece.type);h.quiz=e.operate(t)}catch(e){console.error(e.message),h.quiz=h.quiz.format()}else h.quiz=h.quiz.format();a.piece.type!==n.Piece.Empty&&(p=a.piece),e.changed||0===l?(y={obj:e.field.copy()},h.refIndex.field=l):y={ref:h.refIndex.field};const x={field:y,comment:c,index:l,piece:p,flags:{quiz:v,lock:a.lock,mirror:a.mirror,colorize:a.colorize,rise:a.rise}};f.push(x),o(e.field.copy(),p,void 0!==h.quiz?h.quiz.format().toString():h.lastCommentText),l+=1,a.lock&&(n.isMinoPiece(a.piece.type)&&e.field.put(a.piece),e.field.clearLine(),a.rise&&e.field.up(),a.mirror&&e.field.mirror()),g=e.field}return f}t.extract=g,t.decode=async function(e,t=(()=>{})){const{version:o,data:n}=g(e);switch(o){case"115":return h(n,23,t);case"110":return h(n,21,t)}},t.innerDecode=h,t.encode=async function(e,t=!1){let o=-1;const i=new a.Values;let c=new r.Field({});const m=new d.Pages(e),g=t=>{const r=m.getField(t),d=e[t],g=void 0!==r?r.copy():c.copy(),h=d.commands;void 0!==h&&Object.keys(h.pre).map((e=>h.pre[e])).forEach((e=>{switch(e.type){case"block":{const{x:t,y:o,piece:n}=e;return void g.setToPlayField(t+10*o,n)}case"sentBlock":{const{x:t,y:o,piece:n}=e;return void g.setToSentLine(t+10*o,n)}}})),((e,t)=>{const{changed:n,values:r}=function(e,t){const o=24*p,n=new a.Values,i=(o,n)=>{const i=23-n-1;return t.get(o,i)-e.get(o,i)+8},r=(e,t)=>{const i=e*o+t;n.push(i,2)};let s=!1,c=i(0,0),d=-1;for(let e=0;e<24;e+=1)for(let t=0;t<p;t+=1){const o=i(t,e);o!==c?(r(c,d),d=0,c=o,s=!0):d+=1}return r(c,d),{values:n,changed:s}}(e,t);if(n)i.merge(r),o=-1;else if(o<0||i.get(o)===a.ENCODE_TABLE_LENGTH-1)i.merge(r),i.push(0),o=i.length-1;else if(i.get(o)<a.ENCODE_TABLE_LENGTH-1){const e=i.get(o);i.set(o,e+1)}})(c,g);const f=void 0!==d.comment.text&&(0!==t||""!==d.comment.text),y={piece:void 0!==d.piece?d.piece:{type:n.Piece.Empty,rotation:n.Rotation.Reverse,coordinate:{x:0,y:22}},rise:d.flags.rise,mirror:d.flags.mirror,colorize:d.flags.colorize,lock:d.flags.lock,comment:f},v=s.encodeAction(y);if(i.push(v,3),void 0!==d.comment.text&&f){const e=escape(d.comment.text),t=Math.min(e.length,4095);i.push(t,2);for(let o=0;o<t;o+=4){let n=0;for(let i=0;i<4;i+=1){const r=o+i;if(t<=r)break;n+=(x=e.charAt(r),l.indexOf(x)*Math.pow(u,i))}i.push(n,5)}}var x;y.lock&&(n.isMinoPiece(y.piece.type)&&g.put(y.piece),g.clearLine(),y.rise&&g.up(),y.mirror&&g.mirror()),c=g},h=async e=>{g(e)};for(let o=0;o<e.length;o+=1)t?await h(o):g(o);const f=i.toString();if(f.length<41)return f;const y=[f.substr(0,42)],v=f.substring(42).match(/[\S]{1,47}/g)||[];return y.concat(v).join("?")}},4826:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Quiz=void 0;const n=o(8286),i=o(9774);class r{constructor(e){this.quiz=r.verify(e)}get next(){const e=this.quiz.indexOf(")")+1,t=this.quiz[e];return void 0===t||";"===t?"":t}static isQuizComment(e){return e.startsWith("#Q=")}static create(e,t){const o=(e,t)=>{const o=e=>e||"";return new r(`#Q=[${o(e)}](${o(t[0])})${o(t.substring(1))}`)};return void 0!==t?o(e,t):o(void 0,e)}static trim(e){return e.trim().replace(/\s+/g,"")}get least(){const e=this.quiz.indexOf(")");return this.quiz.substr(e+1)}get current(){const e=this.quiz.indexOf("(")+1,t=this.quiz[e];return")"===t?"":t}get hold(){const e=this.quiz.indexOf("[")+1,t=this.quiz[e];return"]"===t?"":t}get leastAfterNext2(){const e=this.quiz.indexOf(")");return";"===this.quiz[e+1]?this.quiz.substr(e+1):this.quiz.substr(e+2)}getOperation(e){const t=i.parsePieceName(e),o=this.current;if(t===o)return i.Operation.Direct;const r=this.hold;if(t===r)return i.Operation.Swap;if(""===r){if(t===this.next)return i.Operation.Stock}else if(""===o&&t===this.next)return i.Operation.Direct;throw new n.FumenError(`Unexpected hold piece in quiz: ${this.quiz}`)}get leastInActiveBag(){const e=this.quiz.indexOf(";"),t=0<=e?this.quiz.substring(0,e):this.quiz,o=t.indexOf(")");return";"===t[o+1]?t.substr(o+1):t.substr(o+2)}static verify(e){const t=this.trim(e);if(0===t.length||"#Q=[]()"===e||!e.startsWith("#Q="))return e;if(!t.match(/^#Q=\[[TIOSZJL]?]\([TIOSZJL]?\)[TIOSZJL]*(;.*)?$/i))throw new n.FumenError(`Current piece doesn't exist, however next pieces exist: ${e}`);return t}direct(){if(""===this.current){const e=this.leastAfterNext2;return new r(`#Q=[${this.hold}](${e[0]})${e.substr(1)}`)}return new r(`#Q=[${this.hold}](${this.next})${this.leastAfterNext2}`)}swap(){if(""===this.hold)throw new n.FumenError(`Cannot find hold piece: ${this.quiz}`);const e=this.next;return new r(`#Q=[${this.current}](${e})${this.leastAfterNext2}`)}stock(){if(""!==this.hold||""===this.next)throw new n.FumenError(`Cannot stock: ${this.quiz}`);const e=this.leastAfterNext2,t=void 0!==e[0]?e[0]:"";return 1<e.length?new r(`#Q=[${this.current}](${t})${e.substr(1)}`):new r(`#Q=[${this.current}](${t})`)}operate(e){switch(e){case i.Operation.Direct:return this.direct();case i.Operation.Swap:return this.swap();case i.Operation.Stock:return this.stock()}}format(){const e=this.nextIfEnd();if("#Q=[]()"===e.quiz)return new r("");const t=e.current,o=e.hold;if(""===t&&""!==o)return new r(`#Q=[](${o})${e.least}`);if(""===t){const t=e.least,o=t[0];return new r(void 0===o?"":";"===o?t.substr(1):`#Q=[](${o})${t.substr(1)}`)}return e}getHoldPiece(){if(!this.canOperate())return i.Piece.Empty;const e=this.hold;return void 0===e||""===e||";"===e?i.Piece.Empty:i.parsePiece(e)}getNextPieces(e){if(!this.canOperate())return void 0!==e?Array.from({length:e}).map((()=>i.Piece.Empty)):[];let t=(this.current+this.next+this.leastInActiveBag).substr(0,e);return void 0!==e&&t.length<e&&(t+=" ".repeat(e-t.length)),t.split("").map((e=>void 0===e||" "===e||";"===e?i.Piece.Empty:i.parsePiece(e)))}toString(){return this.quiz}canOperate(){let e=this.quiz;return e.startsWith("#Q=[]();")&&(e=this.quiz.substr(8)),e.startsWith("#Q=")&&"#Q=[]()"!==e}nextIfEnd(){return this.quiz.startsWith("#Q=[]();")?new r(this.quiz.substr(8)):this}}t.Quiz=r},2375:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Values=t.ENCODE_TABLE_LENGTH=void 0;const n=o(8286),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function r(e){return i.indexOf(e)}function s(e){return i[e]}t.ENCODE_TABLE_LENGTH=i.length,t.Values=class{constructor(e=""){this.values=e.split("").map(r)}poll(e){let o=0;for(let i=0;i<e;i+=1){const e=this.values.shift();if(void 0===e)throw new n.FumenError("Unexpected");o+=e*Math.pow(t.ENCODE_TABLE_LENGTH,i)}return o}push(e,o=1){let n=e;for(let e=0;e<o;e+=1)this.values.push(n%t.ENCODE_TABLE_LENGTH),n=Math.floor(n/t.ENCODE_TABLE_LENGTH)}merge(e){for(const t of e.values)this.values.push(t)}isEmpty(){return 0===this.values.length}get length(){return this.values.length}get(e){return this.values[e]}set(e,t){this.values[e]=t}toString(){return this.values.map(s).join("")}}},5584:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HyperStage=void 0;const n=o(6314);t.HyperStage=class{constructor(){}addStage(e){this.stage=e}removeStage(){void 0!==this.stage&&(this.stage.removeChildren(),this.stage=void 0)}get isReady(){return void 0!==this.stage}resize(e){void 0!==this.stage&&this.stage.setSize(e)}batchDraw(){void 0!==this.stage&&this.stage.batchDraw()}reload(e){if(void 0!==this.stage){const t=this.stage;setTimeout((async()=>{const o=async e=>new Promise((t=>setTimeout(t,e))),i=async e=>{e.hide(),t.batchDraw(),await o(4)},r=n.resources.konva.layers;await i(r.boxes),await i(r.field),await i(r.background),e((e=>{const n=async e=>{e.show(),t.batchDraw(),await o(6)},i=void 0!==e?e:30;setTimeout((async()=>{await o(i),await n(r.background),await n(r.field),await n(r.boxes)}),0)}))}),0)}}}},3876:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.inferPiece=void 0;const n=o(9774),i=[{positions:[0,1,10,11],result:{piece:n.Piece.O,rotate:n.Rotation.Spawn,offset:{x:0,y:0}}},{positions:[0,1,2,3],result:{piece:n.Piece.I,rotate:n.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,10,20,30],result:{piece:n.Piece.I,rotate:n.Rotation.Right,offset:{x:0,y:2}}},{positions:[0,1,2,11],result:{piece:n.Piece.T,rotate:n.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,9,10,11],result:{piece:n.Piece.T,rotate:n.Rotation.Reverse,offset:{x:0,y:1}}},{positions:[0,10,11,20],result:{piece:n.Piece.T,rotate:n.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,9,10,20],result:{piece:n.Piece.T,rotate:n.Rotation.Left,offset:{x:0,y:1}}},{positions:[0,1,11,12],result:{piece:n.Piece.S,rotate:n.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,9,10,19],result:{piece:n.Piece.S,rotate:n.Rotation.Right,offset:{x:-1,y:1}}},{positions:[0,1,9,10],result:{piece:n.Piece.Z,rotate:n.Rotation.Spawn,offset:{x:0,y:0}}},{positions:[0,10,11,21],result:{piece:n.Piece.Z,rotate:n.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,1,2,12],result:{piece:n.Piece.L,rotate:n.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,10,11,12],result:{piece:n.Piece.L,rotate:n.Rotation.Reverse,offset:{x:1,y:1}}},{positions:[0,1,10,20],result:{piece:n.Piece.L,rotate:n.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,10,19,20],result:{piece:n.Piece.L,rotate:n.Rotation.Left,offset:{x:0,y:1}}},{positions:[0,1,2,10],result:{piece:n.Piece.J,rotate:n.Rotation.Spawn,offset:{x:1,y:0}}},{positions:[0,8,9,10],result:{piece:n.Piece.J,rotate:n.Rotation.Reverse,offset:{x:-1,y:1}}},{positions:[0,10,20,21],result:{piece:n.Piece.J,rotate:n.Rotation.Right,offset:{x:0,y:1}}},{positions:[0,1,11,21],result:{piece:n.Piece.J,rotate:n.Rotation.Left,offset:{x:1,y:1}}}],r=e=>{let t=0,o="";for(const n of e){const e=Math.floor(n/10);if(t+1<e)return"";t=e,o+=`${n},`}return o},s=new Map;for(const e of i){const t=r(e.positions);s.set(t,e.result)}const a=(e,t)=>e-t;t.inferPiece=e=>{if(4!==e.length)return;const t=new Set;e.forEach((e=>t.add(Math.floor(e/10))));const o=Array.from(t.keys()).map(Number).sort(a),n={};o.forEach(((e,t)=>{n[`${e}`]=t}));const i=e.sort(a),c=i.map((e=>{const t=e%10,o=Math.floor(e/10);return 10*n[`${o}`]+t}));let d=!1;for(let e=1;e<o.length;e+=1)if(1<o[e]-o[e-1]){d=!0;break}const l=c[0],u=c.map((e=>e-l)),m=s.get(r(u));if(!m)return;const p=i[0],g=p%10,h=Math.floor(p/10);return{piece:m.piece,rotate:m.rotate,coordinate:d?void 0:{x:g+m.offset.x,y:h+m.offset.y}}}},1983:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseToCommands=t.PageFieldOperation=t.Pages=t.isQuizCommentResult=t.isTextCommentResult=void 0;const n=o(8286),i=o(9774),r=o(4826);function s(e){return void 0!==e.text}t.isTextCommentResult=s,t.isQuizCommentResult=function(e){return void 0!==e.quiz};class a{constructor(e){this.pages=e}static extractNext(e){const t=[],o=e[0];let n=void 0!==o.piece?o.piece.type:i.Piece.Empty;for(const o of e){if(void 0!==o.piece&&n!==o.piece.type){const e=o.piece.type;i.isMinoPiece(e)&&t.push(e),n=e}if(5<=t.length)break;(void 0===o.piece||o.flags.lock)&&(n=i.Piece.Empty)}return t}getComment(e){return this.pages[e].flags.quiz?this.restructureQuiz(e):this.getDescription(e)}setComment(e,t){const o=this.pages[e];void 0===o.comment.text&&this.freezeComment(e),void 0!==o.comment.text&&(o.comment.text=t)}getField(e,t=c.None){return this.restructureField(e,t)}insertRefPage(e){if(e<0)throw new n.FumenError(`Illegal index: ${e}`);const t=this.pages[e-1];if(void 0===t)throw new n.FumenError(`Not found prev page: ${e}`);const o={index:e,field:{ref:void 0},comment:{ref:void 0},flags:{lock:t.flags.lock,mirror:!t.flags.lock&&t.flags.mirror,colorize:t.flags.colorize,rise:!t.flags.lock&&t.flags.rise,quiz:t.flags.quiz},piece:t.flags.lock?void 0:t.piece};if(void 0!==t.field.ref)o.field.ref=t.field.ref;else{if(void 0===t.field.obj)throw new n.FumenError(`Unexpected field: ${t.field}`);o.field.ref=e-1}if(void 0!==t.comment.ref)o.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new n.FumenError(`Unexpected comment: ${t.comment}`);o.comment.ref=e-1}this.insertPage(e,[o])}insertKeyPage(e){if(e<0)throw new n.FumenError(`Illegal index: ${e}`);const t=this.pages[e-1];if(void 0===t)throw new n.FumenError(`Not found prev page: ${e}`);const o={index:e,field:{obj:this.restructureField(e-1,c.All)},comment:{ref:void 0},flags:{lock:t.flags.lock,mirror:!t.flags.lock&&t.flags.mirror,colorize:t.flags.colorize,rise:!t.flags.lock&&t.flags.rise,quiz:t.flags.quiz},piece:t.flags.lock?void 0:t.piece};if(void 0!==t.comment.ref)o.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new n.FumenError(`Unexpected comment: ${t.comment}`);o.comment.ref=e-1}this.insertPage(e,[o])}insertPage(e,t){if(void 0===t[0])throw new n.ViewError("No inserted pages");const o=t[0].index,i=t.map(((t,n)=>{if(t.index=e+n,void 0!==t.field.ref){const n=t.field.ref;t.field.ref=e+(n-o)}if(void 0!==t.comment.ref){const n=t.comment.ref;t.comment.ref=e+(n-o)}return t})),r=i.length,s=i[r-1],a={field:void 0!==s.field.ref?s.field.ref:s.index,comment:void 0!==s.comment.ref?s.comment.ref:s.index};this.pages=this.pages.slice(0,e).concat(i).concat(this.pages.slice(e).map((t=>{if(t.index+=r,void 0!==t.field.ref){const o=t.field.ref;o<e?t.field.ref=a.field:e<=o&&(t.field.ref+=r)}if(void 0!==t.comment.ref){const o=t.comment.ref;o<e?t.comment.ref=a.comment:e<=o&&(t.comment.ref+=r)}return t})))}duplicatePage(e){if(e<0)throw new n.FumenError(`Illegal index: ${e}`);const t=this.pages[e-1];if(void 0===t)throw new n.FumenError(`Not found prev page: ${e}`);const o={index:e,field:{obj:this.restructureField(e-1,c.Command)},comment:{ref:void 0},flags:{...t.flags},piece:void 0!==t.piece?{type:t.piece.type,rotation:t.piece.rotation,coordinate:{...t.piece.coordinate}}:void 0};if(void 0!==t.comment.ref)o.comment.ref=t.comment.ref;else{if(void 0===t.comment.text)throw new n.FumenError(`Unexpected comment: ${t.comment}`);o.comment.ref=e-1}this.insertPage(e,[o])}deletePage(e,t){const o=this.pages[t],n={field:0,comment:0},i=this.pages.slice(0,e).reverse();if(void 0!==o&&void 0!==o.field.obj)n.field=e;else{const t=i.findIndex((e=>void 0!==e.field.obj));n.field=0<=t?e-t-1:0}if(void 0!==o&&void 0!==o.comment.text)n.comment=e;else{const t=i.findIndex((e=>void 0!==e.comment.text));n.comment=0<=t?e-t-1:0}const r=t-e;this.pages=this.pages.slice(0,e).concat(this.pages.slice(t).map((t=>{if(t.index-=r,void 0!==t.field.ref){const o=t.field.ref;o<=e?t.field.ref=n.field:e<o&&(t.field.ref-=r)}if(void 0!==t.comment.ref){const o=t.comment.ref;o<=e?t.comment.ref=n.comment:e<o&&(t.comment.ref-=r)}return t})))}toRefPage(e){const o=this.pages;if(e<=0||o.length<=e)throw new n.FumenError(`Illegal index: ${e}`);if(void 0===o[e].field.obj)throw new n.FumenError(`Not found field obj: ${e}`);const i=this.getField(e-1,c.All),r=this.getField(e,c.Command);o[e].commands=t.parseToCommands(i,r);let s=0;for(let t=e-1;0<=t;t-=1)if(void 0!==o[t].field.obj){s=t;break}for(let t=s+1;t<o.length;t+=1)o[t].field.ref===e&&(o[t].field.ref=s);o[e].field={ref:s}}toKeyPage(e){const t=this.pages;if(e<=0||t.length<=e)return;if(void 0===t[e].field.ref)return;const o=this.getField(e,c.None);for(let o=e+1;o<t.length;o+=1){const n=t[o].field.ref;void 0!==n&&n<e&&(t[o].field.ref=e)}t[e].field={obj:o}}freezeComment(e){const t=this.pages;if(e<=0||t.length<=e)return;const o=t[e];if(void 0===o)throw new n.FumenError("Not found page");if(void 0!==o.comment.text)return;if(void 0===o.comment.ref)return;const i=this.getComment(e);s(i)?o.comment={text:i.text}:o.comment={text:i.quiz};for(let o=e+1;o<t.length;o+=1){const n=t[o].comment.ref;void 0!==n&&n<e&&(t[o].comment.ref=e)}}unfreezeComment(e){const t=this.pages;if(e<=0||t.length<=e)return;const o=t[e];if(void 0===o)throw new n.FumenError("Not found page");if(void 0!==o.comment.ref)return;if(void 0===o.comment.text)return;let i=0;for(let o=e-1;0<=o;o-=1)if(void 0===t[o].comment.ref){i=o;break}for(let o=e+1;o<t.length;o+=1){const n=t[o].comment.ref;void 0!==n&&n===e&&(t[o].comment.ref=i)}t[e].comment={ref:i}}restructureQuiz(e){const t=this.pages[e],o=e=>{if(r.Quiz.isQuizComment(e))try{return new r.Quiz(e)}catch(e){return}};return(()=>{let r;if(void 0!==t.comment.text){const n=t.comment.text;r={comment:n,quiz:o(n),startIndex:e}}else{const e=t.comment.ref;if(void 0===e)throw new n.ViewError("Cannot open reference for comment");const i=this.pages[e];if(void 0===i.comment.text)throw new n.ViewError("Not found quiz");const s=i.comment.text;r={comment:s,quiz:o(s),startIndex:e}}if(!r.quiz)return this.getDescription(e);let s={quiz:r.quiz,comment:r.comment},c={quizAfterOperation:s.quiz,quiz:s.comment};for(let t=r.startIndex;t<=e;t+=1){const o=this.pages[t];if(!o.flags.quiz)throw new n.ViewError("Unexpected quiz operation");const r=s.quiz;if(!r.canOperate())return{text:s.comment,next:a.extractNext(this.pages.slice(e))};if(o.flags.lock)if(void 0!==o.piece&&i.isMinoPiece(o.piece.type))try{const e=r.nextIfEnd(),t=e.getOperation(o.piece.type),n=e.operate(t);c={quizAfterOperation:n,quiz:s.comment},s={quiz:n,comment:n.format().toString()}}catch(e){console.error(e),c={quizAfterOperation:s.quiz,quiz:s.comment};const t=r.format();s={quiz:t,comment:t.toString()}}else{c={quizAfterOperation:s.quiz,quiz:s.comment};const e=r.format();s={quiz:e,comment:e.toString()}}else c={quizAfterOperation:s.quiz,quiz:s.comment}}return c})()}getDescription(e){const t=this.pages[e];return{next:a.extractNext(this.pages.slice(e)),text:(()=>{if(void 0!==t.comment.text)return t.comment.text;if(void 0!==t.comment.ref){const e=this.pages[t.comment.ref];if(void 0===e.comment.text)throw new n.ViewError("Unexpected comment");return e.comment.text}throw new n.ViewError("Not found comment")})()}}restructureField(e,t){const o=this.pages[e];return(()=>{let r;if(void 0!==o.field.obj)r={field:o.field.obj.copy(),startIndex:e,cache:!1};else{const e=o.field.ref;if(void 0===e)throw new n.ViewError("Cannot open reference for comment");const t=this.pages[e];if(void 0===t.field.obj)throw new n.ViewError("Not found quiz");r={field:t.field.obj.copy(),startIndex:e,cache:!1}}const{field:s,startIndex:a}=r;let d;for(let o=a;o<=e;o+=1){const n=o===e;if(n&&t===c.None)return s;d=s.copy();const{flags:r,piece:a,commands:l}=this.pages[o];if(void 0!==l&&Object.keys(l.pre).map((e=>l.pre[e])).forEach((e=>{switch(e.type){case"block":{const{x:t,y:o,piece:n}=e;return void s.setToPlayField(t+10*o,n)}case"sentBlock":{const{x:t,y:o,piece:n}=e;return void s.setToSentLine(t+10*o,n)}}})),n&&t===c.Command)return s;r.lock&&(void 0!==a&&i.isMinoPiece(a.type)&&s.put(a),s.clearLine(),r.rise&&s.up(),r.mirror&&s.mirror())}return s})()}setQuizFlag(e){this.changeQuizFlag(e,!0)}unsetQuizFlag(e){this.changeQuizFlag(e,!1)}changeQuizFlag(e,t){const o=this.pages[e];if(void 0===o.comment.text)throw new n.FumenError(`Comment does not exist in page: index=${e}, flag=${t}`);o.flags.quiz=t;for(let o=e+1;o<this.pages.length;o+=1){const n=this.pages[o];if(n.comment.ref!==e)break;n.flags.quiz=t}}}var c;t.Pages=a,function(e){e.None="None",e.Command="Command",e.All="All"}(c=t.PageFieldOperation||(t.PageFieldOperation={})),t.parseToCommands=(e,t)=>{const o={pre:{}};for(let n=-1;n<23;n+=1)for(let i=0;i<10;i+=1){const r=e.get(i,n),s=t.get(i,n),a=0<=n,c=a?"block":"sentBlock",d=`${c}-${a?i+10*n:i}`;r!==s&&(o.pre[d]={x:i,type:c,y:a?n:n+1,piece:s})}return o}},8711:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPieces=t.getBlocks=t.getBlockPositions=void 0;const n=o(8286),i=o(9774);function r(e,t){const o=s(e);switch(t){case i.Rotation.Spawn:return o;case i.Rotation.Left:return o.map((e=>[-e[1],e[0]]));case i.Rotation.Reverse:return o.map((e=>[-e[0],-e[1]]));case i.Rotation.Right:return function(e){return e.map((e=>[e[1],-e[0]]))}(o)}}function s(e){switch(e){case i.Piece.I:return[[0,0],[-1,0],[1,0],[2,0]];case i.Piece.T:return[[0,0],[-1,0],[1,0],[0,1]];case i.Piece.O:return[[0,0],[1,0],[0,1],[1,1]];case i.Piece.L:return[[0,0],[-1,0],[1,0],[1,1]];case i.Piece.J:return[[0,0],[-1,0],[1,0],[-1,1]];case i.Piece.S:return[[0,0],[-1,0],[0,1],[1,1]];case i.Piece.Z:return[[0,0],[1,0],[0,1],[-1,1]]}throw new n.FumenError("Unsupported rotation")}t.getBlockPositions=function(e,t,o,n){return r(e,t).map((e=>(e[0]+=o,e[1]+=n,e)))},t.getBlocks=r,t.getPieces=s},5187:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateKey=void 0;const o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";t.generateKey=(e=8)=>{const t=o.length;return Array.from({length:e}).map((()=>o[Math.floor(Math.random()*t)])).join("")}},7989:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.testRightRotation=t.testLeftRotation=void 0;const n=o(9774),i={[n.Rotation.Spawn]:[[0,0],[-1,0],[2,0],[-1,0],[2,0]],[n.Rotation.Right]:[[-1,0],[0,0],[0,0],[0,1],[0,-2]],[n.Rotation.Reverse]:[[-1,1],[1,1],[-2,1],[1,0],[-2,0]],[n.Rotation.Left]:[[0,1],[0,1],[0,1],[0,-1],[0,2]]},r={[n.Rotation.Spawn]:[[0,0]],[n.Rotation.Right]:[[0,-1]],[n.Rotation.Reverse]:[[-1,-1]],[n.Rotation.Left]:[[-1,0]]},s={[n.Rotation.Spawn]:[[0,0],[0,0],[0,0],[0,0],[0,0]],[n.Rotation.Right]:[[0,0],[1,0],[1,-1],[0,2],[1,2]],[n.Rotation.Reverse]:[[0,0],[0,0],[0,0],[0,0],[0,0]],[n.Rotation.Left]:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]]},a=e=>{switch(e){case n.Piece.I:return i;case n.Piece.O:return r;default:return s}};t.testLeftRotation=(e,t)=>{const o=a(e),i=o[t],r=n.nextRotationToLeft(t),s=o[r],c=[];for(let e=0;e<i.length;e+=1)c.push([i[e][0]-s[e][0],i[e][1]-s[e][1]]);return{test:c,rotation:r}},t.testRightRotation=(e,t)=>{const o=a(e),i=o[t],r=n.nextRotationToRight(t),s=o[r],c=[];for(let e=0;e<i.length;e+=1)c.push([i[e][0]-s[e][0],i[e][1]-s[e][1]]);return{test:c,rotation:r}}},4055:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.px=t.style=void 0,t.style=e=>e,t.px=function(e){return`${e}px`}},7486:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=void 0,t.resources={Top:{RestoreFromStorage:"Restored to last state"},OpenFumen:{Title:"Open fumen",PlaceHolder:"URL or v115@~ / Support v115 or v110",Buttons:{Open:"Open",Cancel:"Cancel"},Errors:{FailedToLoad:"Failed to load",Unexpected:"Unexpected error: {{message}}"}},AppendFumen:{Title:"Append fumen",PlaceHolder:"URL or v115@~ / Support v115 or v110",Buttons:{Cancel:"Cancel"},Errors:{FailedToLoad:"Failed to load",Unexpected:"Unexpected error: {{message}}"}},UserSettings:{Title:"User Settings",Notice:"Clearing the browser cache will initialize the settings.",Ghost:{Title:"Show the ghost",Off:()=>"Off",On:()=>"On"},Loop:{Title:"Loop on page navigation [Reader]",Off:()=>"Off",On:()=>"On"},Buttons:{Save:"Save",Cancel:"Cancel"}},Clipboard:{Title:"Copy to clipboard",Buttons:{Close:"Close"}},Menu:{Title:"Menu",Build:"build {{version}}",Buttons:{Readonly:"Readonly",Writable:"Edit",Clipboard:"Clipboard",FirstPage:"FirstPage",LastPage:"LastPage",New:"New",Open:"Open",Help:"Help",ShowComment:"ShowText",ReadonlyComment:"ReadText",WritableComment:"WriteText",PageSlider:"PageSlider",ClearToEnd:"Clear->",ClearPast:"<-Clear",Append:"Append",GhostOn:"GhostOn",GhostOff:"GhostOff",UserSettings:"Settings"},Messages:{NoAvailableCommentButton:"Available only when writable mode"}},Navigator:{OpenInPC:"Open in Hard Drop",ExternalFumenURL:"https://harddrop.com/fumen/?{{data}}"}}},1307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=void 0,t.resources={Top:{RestoreFromStorage:""},OpenFumen:{Title:"",Buttons:{Open:"",Cancel:""},Errors:{FailedToLoad:""}},AppendFumen:{Title:"",Buttons:{Cancel:""},Errors:{FailedToLoad:""}},UserSettings:{Title:"",Notice:"",Ghost:{Title:"",Off:()=>"",On:()=>""},Loop:{Title:" [Reader]",Off:()=>"",On:()=>""},Buttons:{Save:"",Cancel:""}},Clipboard:{Title:""},Menu:{Messages:{NoAvailableCommentButton:"Writable"}},Navigator:{OpenInPC:"PC",ExternalFumenURL:"https://fumen.zui.jp/?{{data}}"}}},4257:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=void 0;const n=o(655).__importDefault(o(2181)),i=(e,t)=>n.default.t(e,t);t.i18n={Top:{RestoreFromStorage:()=>i("Top.RestoreFromStorage")},OpenFumen:{Title:()=>i("OpenFumen.Title"),PlaceHolder:()=>i("OpenFumen.PlaceHolder"),Buttons:{Open:()=>i("OpenFumen.Buttons.Open"),Cancel:()=>i("OpenFumen.Buttons.Cancel")},Errors:{FailedToLoad:()=>i("OpenFumen.Errors.FailedToLoad"),Unexpected:e=>i("OpenFumen.Errors.Unexpected",{message:e})}},AppendFumen:{Title:()=>i("AppendFumen.Title"),PlaceHolder:()=>i("AppendFumen.PlaceHolder"),Buttons:{Cancel:()=>i("AppendFumen.Buttons.Cancel")},Errors:{FailedToLoad:()=>i("AppendFumen.Errors.FailedToLoad"),Unexpected:e=>i("AppendFumen.Errors.Unexpected",{message:e})}},UserSettings:{Title:()=>i("UserSettings.Title"),Notice:()=>i("UserSettings.Notice"),Ghost:{Title:()=>i("UserSettings.Ghost.Title"),Off:()=>i("UserSettings.Ghost.Off"),On:()=>i("UserSettings.Ghost.On")},Loop:{Title:()=>i("UserSettings.Loop.Title"),Off:()=>i("UserSettings.Loop.Off"),On:()=>i("UserSettings.Loop.On")},Buttons:{Save:()=>i("UserSettings.Buttons.Save"),Cancel:()=>i("UserSettings.Buttons.Cancel")}},Clipboard:{Title:()=>i("Clipboard.Title"),Buttons:{Close:()=>i("Clipboard.Buttons.Close")}},Menu:{Title:()=>i("Menu.Title"),Build:e=>i("Menu.Build",{version:e}),Buttons:{Readonly:()=>i("Menu.Buttons.Readonly"),Writable:()=>i("Menu.Buttons.Writable"),Clipboard:()=>i("Menu.Buttons.Clipboard"),FirstPage:()=>i("Menu.Buttons.FirstPage"),LastPage:()=>i("Menu.Buttons.LastPage"),New:()=>i("Menu.Buttons.New"),Open:()=>i("Menu.Buttons.Open"),ShowComment:()=>i("Menu.Buttons.ShowComment"),ReadonlyComment:()=>i("Menu.Buttons.ReadonlyComment"),WritableComment:()=>i("Menu.Buttons.WritableComment"),PageSlider:()=>i("Menu.Buttons.PageSlider"),Help:()=>i("Menu.Buttons.Help"),ClearToEnd:()=>i("Menu.Buttons.ClearToEnd"),ClearPast:()=>i("Menu.Buttons.ClearPast"),Append:()=>i("Menu.Buttons.Append"),GhostOn:()=>i("Menu.Buttons.GhostOn"),GhostOff:()=>i("Menu.Buttons.GhostOff"),UserSettings:()=>i("Menu.Buttons.UserSettings")},Messages:{NoAvailableCommentButton:()=>i("Menu.Messages.NoAvailableCommentButton")}},Navigator:{OpenInPC:()=>i("Navigator.OpenInPC"),ExternalFumenURL:e=>i("Navigator.ExternalFumenURL",{data:e,interpolation:{escapeValue:!1}})}}},6266:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.localStorageWrapper=t.memento=void 0;const n=o(655),i=o(2995),r=o(5187),s=o(2315),a=n.__importDefault(o(6486)),c={isWorking:!1,last:{key:r.generateKey(),saverObj:void 0}},d=e=>{const o=r.generateKey(),n=(({saveKey:e,pages:t},o)=>{let n=!1;return{save:async i=>{if(n||i!==e)return;n=!0;const r=await(async e=>{c.isWorking=!0;const t=await s.encode(e,!0);return c.isWorking=!1,`v115@${t}`})(t);setTimeout((()=>o(r)),0);const a=c.last;void 0!==a.saverObj&&await a.saverObj.save(a.key)}}})({pages:e,saveKey:o},(e=>{t.localStorageWrapper.saveFumen(e)}));c.last={key:o,saverObj:n},setTimeout((()=>{n.save(c.last.key).catch((e=>console.error(e)))}),c.isWorking?3e3:0)};t.memento=(()=>{const e=[];let t=[];return{save:e=>{d(e)},register:(o,n)=>{const r=e[e.length-1];return void 0!==r&&r.key===n&&i.isOperationTask(r)&&i.isOperationTask(o)?e[e.length-1]=i.toDecoratorOperationTask(r,o):(e.length<200||e.shift(),e.push(o)),t=[],e.length-1},undo:async o=>{const n=e.pop();if(void 0===n)return;t.push(n);const i=n.fixed?await n.revert():n.revert(o);return{pages:i.pages,index:i.index,undoCount:e.length-1,redoCount:t.length}},redo:async o=>{const n=t.pop();if(void 0===n)return;e.push(n);const i=n.fixed?await n.replay():n.replay(o);return{pages:i.pages,index:i.index,undoCount:e.length-1,redoCount:t.length}},lastKey:()=>{const t=e[e.length-1];return void 0!==t?t.key:void 0}}})();const l={fumenV115:e=>{const t=l.string(e);return t&&/^v115@[a-zA-Z0-9+/?]+$/.test(t)?t:void 0},string:e=>a.default.isString(e)?e:void 0,boolean:e=>a.default.isBoolean(e)?e:void 0};t.localStorageWrapper={saveFumen:e=>{localStorage.setItem("data@1",e)},loadFumen:()=>{const e=localStorage.getItem("data@1");return l.fumenV115(e)},saveUserSettings:e=>{localStorage.setItem("user-settings@1",JSON.stringify(e))},loadUserSettings:()=>{const e=localStorage.getItem("user-settings@1");if(!e)return{};const t=JSON.parse(e);return{ghostVisible:l.boolean(t.ghostVisible),loop:l.boolean(t.loop)}}}},4848:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getURLQuery=void 0,t.getURLQuery=()=>{let e="";if(""!==location.search)e=location.search.substr(1);else{const t=location.hash,o=t.indexOf("?");-1!==o&&(e=t.substr(o+1))}const t=decodeURIComponent(e).split("&");return{get:e=>{const o=t.find((t=>t.startsWith(`${e}=`)));if(o)return o.substr(e.length+1)}}}},2742:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightType=void 0,(o=t.HighlightType||(t.HighlightType={}))[o.Normal=0]="Normal",o[o.Lighter=1]="Lighter",o[o.Highlight1=10]="Highlight1",o[o.Highlight2=11]="Highlight2"},6314:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resources=t.initState=void 0;const n=o(655),i=o(9774),r=o(5584),s=o(7210),a=o(5187),c=n.__importDefault(o(185)),d=o(9782),l=o(4848),u=s.PageEnv.Version;t.initState={field:Array.from({length:230}).map((e=>({piece:i.Piece.Empty}))),sentLine:Array.from({length:10}).map((e=>({piece:i.Piece.Empty}))),comment:{text:"",isChanged:!1,changeKey:a.generateKey()},display:{width:window.document.body.clientWidth,height:window.document.body.clientHeight},hold:void 0,nexts:void 0,play:{status:i.AnimationState.Pause,intervalTime:1500},fumen:{currentIndex:0,maxPage:1,pages:[{index:0,comment:{text:""},field:{obj:new d.Field({})},flags:{colorize:!0,lock:!0,mirror:!1,quiz:!1,rise:!1}}],value:void 0,errorMessage:void 0,guideLineColor:!0},cache:{currentInitField:new d.Field({}),taskKey:void 0},modal:{fumen:!1,menu:!0,append:!1,clipboard:!1,userSettings:!1},temporary:{userSettings:{ghostVisible:!0,loop:!1}},handlers:{animation:void 0},events:{piece:void 0,drawing:!1,inferences:[],prevPage:void 0,updated:!1},mode:{screen:i.Screens.Editor,type:i.ModeTypes.DrawingTool,touch:i.TouchTypes.Drawing,piece:void 0,comment:i.CommentType.Writable,ghostVisible:!0,loop:!1},history:{undoCount:0,redoCount:0},version:u,platform:function(){const e=l.getURLQuery().get("mobile");return e&&Number(e)||navigator.userAgent.match(/iPhone|iPad|Android/)?i.Platforms.Mobile:i.Platforms.PC}()},t.resources={modals:{menu:void 0,fumen:void 0,append:void 0,clipboard:void 0,userSettings:void 0},konva:function(){const e={stage:new r.HyperStage,event:{},background:{},fieldMarginLine:{},fieldBlocks:[],sentBlocks:[],hold:{},nexts:[],layers:{background:new c.default.Layer({name:"background"}),field:new c.default.Layer({name:"field"}),boxes:new c.default.Layer({name:"boxes"}),overlay:new c.default.Layer({name:"overlay"})}},t=e.layers;{const o=new c.default.Rect({strokeWidth:0,opacity:1});e.background=o,t.background.add(o)}{const o=new c.default.Line({points:[]});e.fieldMarginLine=o,t.background.add(o)}{const o=Array.from({length:230}).map((()=>new c.default.Rect({strokeWidth:0,opacity:1})));e.fieldBlocks=o;for(const e of o)t.field.add(e)}{const o=Array.from({length:10}).map((()=>new c.default.Rect({strokeWidth:0,opacity:.75})));e.sentBlocks=o;for(const e of o)t.field.add(e)}{const o=new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1}),n=Array.from({length:4}).map((()=>new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1})));e.hold={background:o,pieces:n};for(const e of[o].concat(n))t.boxes.add(e)}{const o=Array.from({length:5}).map((()=>({background:new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1}),pieces:Array.from({length:4}).map((()=>new c.default.Rect({fill:"#333",strokeWidth:1,stroke:"#666",opacity:1})))})));e.nexts=o;for(const{background:e,pieces:n}of o)for(const o of[e].concat(n))t.boxes.add(o)}{const o=new c.default.Rect({fill:"#333",opacity:0,strokeEnabled:!1,listening:!0});e.event=o,t.overlay.add(o)}return e}(),comment:void 0,focussedElement:void 0}},6085:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=void 0;const n=o(4361),i=o(9774),r=o(3288),s=o(6453),a=o(6691),c=o(5874),d=o(1336),l=o(1699),u=o(3175);t.view=(e,t)=>n.div([(()=>{switch(e.mode.screen){case i.Screens.Reader:return r.view(e,t);case i.Screens.Editor:return s.view(e,t);default:return n.div(["Unexpected mode"])}})(),e.modal.fumen?a.OpenFumenModal({actions:t,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:""}):void 0,e.modal.menu?c.MenuModal({actions:t,pages:e.fumen.pages,state:e,version:e.version,screen:e.mode.screen,currentIndex:e.fumen.currentIndex,maxPageIndex:e.fumen.maxPage,comment:e.mode.comment}):void 0,e.modal.append?d.AppendFumenModal({actions:t,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:""}):void 0,e.modal.clipboard?l.ClipboardModal({actions:t,pages:e.fumen.pages}):void 0,e.modal.userSettings?u.UserSettingsModal({actions:t,ghostVisible:e.temporary.userSettings.ghostVisible,loop:e.temporary.userSettings.loop}):void 0,n.div({key:"view-end"})])},4028:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.blockMode=void 0;const n=o(9774),i=o(4361),r=o(7975),s=o(6453);t.blockMode=({layout:e,modePiece:t,colorize:o,actions:a})=>{const c=[n.Piece.I,n.Piece.L,n.Piece.O,n.Piece.Z,n.Piece.T,n.Piece.J,n.Piece.S,n.Piece.Empty,n.Piece.Gray];return i.div({style:s.toolStyle(e)},[r.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"}),i.div({key:"",style:{},class:""},"block  fill  fillrow")].concat(c.map((n=>r.colorButton({layout:e,piece:n,colorize:o,onclick:a.selectPieceColor,highlight:t===n})))).concat([r.inferenceButton({layout:e,actions:a,highlight:void 0===t})]))}},46:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commentMode=void 0;const n=o(4361),i=o(7975),r=o(6453);t.commentMode=({layout:e,currentIndex:t,actions:o})=>n.div({style:r.toolStyle(e)},[n.div({key:"",style:{},class:""},"comment"),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-comment-blank",key:"btn-comment-blank",onclick:()=>{o.setCommentText({text:"",pageIndex:t})}},i.iconContents({description:"blank",iconSize:22,iconName:"format_strikethrough"})),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-comment-inherit",key:"btn-comment-inherit",enable:0<t,onclick:()=>{o.resetCommentText({pageIndex:t})}},i.iconContents({description:"inherit",iconSize:22,iconName:"forward"}))])},6453:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.getComment=t.toolStyle=void 0;const n=o(9774),i=o(6314),r=o(1809),s=o(3891),a=o(8174),c=o(4245),d=o(6100),l=o(4361),u=o(4055),m=o(4264),p=o(37),g=o(8722),h=o(4028),f=o(4932),y=(o(5224),o(2908)),v=o(2308),x=o(9135),P=(o(6769),o(4961)),b=o(46),k=o(5874),w=o(6691);t.toolStyle=e=>{const t=(e.canvas.size.height-e.field.size.height)/2;return u.style({marginTop:"0px",marginBottom:"0px",marginLeft:"10px",marginRight:"0px",padding:`${u.px(t)} 0px`,display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"center",height:u.px(e.canvas.size.height),width:u.px(e.buttons.size.width)})};const C=(e,t,o)=>{const n=e.fumen.pages[e.fumen.currentIndex],r=void 0===n||void 0!==n.field.obj,s=void 0===e.fumen.pages[0]||e.fumen.pages[0].flags.colorize;return l.div({key:"field-top",id:"field-top",style:u.style({display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",userSelect:"none"})},[c.KonvaCanvas({actions:t,canvas:o.canvas.size,hyperStage:i.resources.konva.stage}),a.Field({fieldMarginWidth:o.field.bottomBorderWidth,topLeft:o.field.topLeft,blockSize:o.field.blockSize,field:e.field,sentLine:e.sentLine,guideLineColor:e.fumen.guideLineColor}),[h.blockMode({layout:o,actions:t,colorize:s,modePiece:e.mode.piece})],g.toolMode({layout:o,actions:t,keyPage:r,touchType:e.mode.touch,currentIndex:e.fumen.currentIndex}),y.flagsMode({layout:o,actions:t,keyPage:r,flags:n.flags,currentIndex:e.fumen.currentIndex}),v.utilsMode({layout:o,actions:t,touchType:e.mode.touch}),b.commentMode({layout:o,actions:t,currentIndex:e.fumen.currentIndex}),x.slideMode({layout:o,actions:t}),f.pieceMode({layout:o,actions:t,move:void 0!==n?n.piece:void 0,existInferences:0<e.events.inferences.length,pages:e.fumen.pages,flags:n.flags,touchType:e.mode.touch,currentIndex:e.fumen.currentIndex}),[P.pieceSelectMode({layout:o,actions:t,currentIndex:e.fumen.currentIndex,colorize:s})]])},T=(e,t)=>{if(void 0!==e.mode)return d.DrawingEventCanvas({actions:t,fieldBlocks:i.resources.konva.fieldBlocks,sentBlocks:i.resources.konva.sentBlocks,fieldLayer:i.resources.konva.layers.field})},S=(e,t,o,n)=>r.EditorTools({actions:t,height:o,palette:n,currentPage:e.fumen.currentIndex+1,maxPage:e.fumen.maxPage,modeType:e.mode.type,undoCount:e.history.undoCount,redoCount:e.history.redoCount,inferenceCount:e.events.inferences.length});t.getComment=(e,t,o)=>{const r=e.fumen.currentIndex,s=e.fumen.pages[r];switch(e.mode.comment){case n.CommentType.Writable:{const n=void 0!==i.resources.comment||void 0!==s&&void 0!==s.comment.text;return m.comment({currentIndex:r,actions:t,key:`text-comment-editor-${e.comment.changeKey}`,dataTest:"text-comment",id:"text-comment",textColor:n?"#333":"#757575",backgroundColorClass:"white",height:o.comment.size.height,text:void 0!==i.resources.comment?i.resources.comment.text:e.comment.text,placeholder:"comment",readonly:!1})}case n.CommentType.Readonly:{const n=e.fumen.currentIndex,r=e.fumen.pages[n],s=void 0!==i.resources.comment||void 0!==r&&void 0!==r.comment.text;return m.comment({currentIndex:n,actions:t,key:`text-comment-editor-readonly-${e.comment.changeKey}`,dataTest:"text-comment",id:"text-comment",textColor:s?"#333":"#757575",backgroundColorClass:"white",height:o.comment.size.height,text:void 0!==i.resources.comment?i.resources.comment.text:e.comment.text,readonly:!0})}case n.CommentType.PageSlider:return p.page_slider({currentIndex:r,actions:t,datatest:"range-page-slider",size:{width:.8*o.comment.size.width,height:o.comment.size.height},maxPage:e.fumen.maxPage})}},t.view=(e,o)=>{const r=e.platform===n.Platforms.PC?30:0,a=(({topLeftY:e,width:t,height:o})=>{const n={width:t,height:o-(85+e+214)},i=Math.min((n.height-2.4-2)/24,(n.width-90)/10.5)-1,r={width:10*(i+1)+1,height:23.5*(i+1)+1+2.4+1},s={width:Math.min(.6*(n.width-r.width),80),height:Math.min(r.height/11.5,40)};return{canvas:{topLeft:{x:0,y:e},size:{width:r.width,height:n.height}},field:{blockSize:i,bottomBorderWidth:2.4,topLeft:{x:0,y:(n.height-r.height)/2},size:{width:r.width,height:r.height}},buttons:{size:s},comment:{topLeft:{x:0,y:o-35-50},size:{width:t,height:35}},tools:{topLeft:{x:0,y:o-50},size:{width:t,height:50}}}})({...e.display,topLeftY:r}),c=s.Palette(n.Screens.Editor),d=()=>i.resources.konva.stage.batchDraw();return l.div({oncreate:d,onupdate:d,key:"view"},[i.resources.konva.stage.isReady?T(e,o):void 0,w.OpenFumenModal({actions:o,errorMessage:e.fumen.errorMessage,textAreaValue:void 0!==e.fumen.value?e.fumen.value:""}),C(e,o,a),l.div({key:"menu-top"},[t.getComment(e,o,a),S(e,o,a.tools.size.height,c)]),k.MenuModal({actions:o,pages:e.fumen.pages,version:e.version,screen:e.mode.screen,currentIndex:e.fumen.currentIndex,maxPageIndex:e.fumen.maxPage,comment:e.mode.comment,state:e})])}},5224:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillMode=void 0;const n=o(9774),i=o(4361),r=o(7975),s=o(6453);t.fillMode=({layout:e,modePiece:t,colorize:o,actions:a})=>{const c=[n.Piece.I,n.Piece.L,n.Piece.O,n.Piece.Z,n.Piece.T,n.Piece.J,n.Piece.S,n.Piece.Empty,n.Piece.Gray];return i.div({style:s.toolStyle(e)},[r.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"})].concat(c.map((n=>r.colorButton({layout:e,piece:n,colorize:o,onclick:a.selectPieceColor,highlight:t===n})))))}},6769:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fillRowMode=void 0;const n=o(9774),i=o(4361),r=o(7975),s=o(6453);t.fillRowMode=({layout:e,modePiece:t,colorize:o,actions:a})=>{const c=[n.Piece.I,n.Piece.L,n.Piece.O,n.Piece.Z,n.Piece.T,n.Piece.J,n.Piece.S,n.Piece.Empty,n.Piece.Gray];return i.div({style:s.toolStyle(e)},[r.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"})].concat(c.map((n=>r.colorButton({layout:e,piece:n,colorize:o,onclick:a.selectPieceColor,highlight:t===n})))).concat([r.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:()=>a.changeToUtilsMode()},r.iconContents({description:"Back",iconSize:25,iconName:"chevron_left"}))]))}},2908:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flagsMode=void 0;const n=o(4361),i=o(7975),r=o(6453);t.flagsMode=({layout:e,currentIndex:t,keyPage:o,flags:s,actions:a})=>n.div({style:r.toolStyle(e)},[i.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"}),n.div({key:"",style:{},class:""},"flags"),i.switchButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-lock-flag",key:"btn-lock-flag",onclick:()=>a.changeLockFlag({index:t,enable:!s.lock}),enable:s.lock},i.switchIconContents({description:"lock",iconSize:22,enable:s.lock})),i.switchButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-rise-flag",key:"btn-rise-flag",onclick:()=>a.changeRiseFlag({index:t,enable:!s.rise}),enable:s.rise},i.switchIconContents({description:"rise",iconSize:22,enable:s.rise})),i.switchButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-mirror-flag",key:"btn-mirror-flag",onclick:()=>a.changeMirrorFlag({index:t,enable:!s.mirror}),enable:s.mirror},i.switchIconContents({description:"mirror",iconSize:22,enable:s.mirror}))])},4932:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pieceMode=void 0;const n=o(9774),i=o(4361),r=o(7975),s=o(6453),a=o(1983);t.pieceMode=({layout:e,currentIndex:t,touchType:o,move:c,pages:d,existInferences:l,flags:u,actions:m})=>{const p=void 0!==c,g=void 0!==c?c.rotation:void 0;return i.div({style:s.toolStyle(e)},[r.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"}),i.div({key:"",style:{},class:""},"piece"),r.rotationButton({layout:e,rotation:g,highlight:!1}),r.switchButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-lock-flag",key:"btn-lock-flag",onclick:()=>m.changeLockFlag({index:t,enable:!u.lock}),enable:u.lock},r.switchIconContents({description:"lock",iconSize:22,enable:u.lock})),r.dualButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-move-to-left-end",key:"btn-move-to-left-end",enable:p,onclick:()=>m.moveToLeftEnd(),contents:r.iconContents({description:"",iconSize:24,iconName:"skip_previous"})},{datatest:"btn-move-to-right-end",key:"btn-move-to-right-end",enable:p,onclick:()=>m.moveToRightEnd(),contents:r.iconContents({description:"",iconSize:24,iconName:"skip_next"})}),r.dualButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-move-to-left",key:"btn-move-to-left",enable:p,onclick:()=>m.moveToLeft(),contents:r.iconContents({description:"",iconSize:24,iconName:"keyboard_arrow_left"})},{datatest:"btn-move-to-right",key:"btn-move-to-right",enable:p,onclick:()=>m.moveToRight(),contents:r.iconContents({description:"",iconSize:24,iconName:"keyboard_arrow_right"})}),r.dualButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-rotate-to-left",key:"btn-rotate-to-left",enable:p,onclick:()=>m.rotateToLeft(),contents:r.iconContents({description:"",iconSize:23,iconName:"rotate_left"})},{datatest:"btn-rotate-to-right",key:"btn-rotate-to-right",enable:p,onclick:()=>m.rotateToRight(),contents:r.iconContents({description:"",iconSize:23,iconName:"rotate_right"})}),r.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-harddrop",key:"btn-harddrop",enable:p,onclick:()=>m.harddrop()},r.iconContents({description:"drop",iconSize:22,iconName:"vertical_align_bottom"})),r.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-reset-piece",enable:l||void 0!==c,key:"btn-reset-piece",onclick:()=>{m.clearPiece()}},r.iconContents({description:"reset",iconSize:23,iconName:"clear"})),r.dualSwitchButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336"},{datatest:"btn-move-piece",key:"btn-move-piece",enable:o===n.TouchTypes.MovePiece,onclick:()=>m.changeToMovePieceMode(),contents:r.iconContents({description:"",iconSize:18,iconName:"pan_tool"})},{datatest:"btn-draw-piece",key:"btn-draw-piece",enable:o===n.TouchTypes.Piece,onclick:()=>m.changeToDrawPieceMode(),contents:r.iconContents({description:"",iconSize:21,iconName:"edit"})}),r.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-select-mode",key:"btn-piece-select-mode",onclick:()=>{const e=new a.Pages(d).getField(t,a.PageFieldOperation.Command);u.lock&&void 0!==c&&e.isOnGround(c.type,c.rotation,c.coordinate.x,c.coordinate.y)&&(m.insertPage({index:t+1}),m.openPage({index:t+1})),m.changeToSelectPieceMode()}},r.iconContents({description:"spawn",iconSize:22,iconName:"add"}))])}},4961:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pieceSelectMode=void 0;const n=o(9774),i=o(4361),r=o(7975),s=o(6453);t.pieceSelectMode=({layout:e,currentIndex:t,colorize:o,actions:a})=>{const c=[n.Piece.I,n.Piece.L,n.Piece.O,n.Piece.Z,n.Piece.T,n.Piece.J,n.Piece.S];return i.div({style:s.toolStyle(e)},[r.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"}),i.div({key:"",style:{},class:""},"piece")].concat(c.map((t=>r.colorButton({layout:e,piece:t,colorize:o,onclick:({piece:e})=>{a.spawnPiece({piece:e,guideline:o}),a.changeToMovePieceMode(),a.changeToPieceMode()},highlight:!1})))).concat([r.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:()=>a.changeToPieceMode()},r.iconContents({description:"Back",iconSize:25,iconName:"chevron_left"}))]))}},9135:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.slideMode=void 0;const n=o(4361),i=o(7975),r=o(6453);t.slideMode=({layout:e,actions:t})=>n.div({style:r.toolStyle(e)},[i.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"}),n.div({key:"",style:{},class:""},"slide"),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-slide-to-up",key:"btn-slide-to-up",onclick:()=>t.shiftToUp()},i.iconContents({description:"",iconSize:22,iconName:"keyboard_arrow_up"})),i.dualButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333"},{datatest:"btn-slide-to-left",key:"btn-slide-to-left",onclick:()=>t.shiftToLeft(),contents:i.iconContents({description:"",iconSize:23,iconName:"keyboard_arrow_left"})},{datatest:"btn-slide-to-right",key:"btn-slide-to-right",onclick:()=>t.shiftToRight(),contents:i.iconContents({description:"",iconSize:23,iconName:"keyboard_arrow_right"})}),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-slide-to-down",key:"btn-slide-to-down",onclick:()=>t.shiftToBottom()},i.iconContents({description:"",iconSize:22,iconName:"keyboard_arrow_down"})),i.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:()=>t.changeToUtilsMode()},i.iconContents({description:"Back",iconSize:25,iconName:"chevron_left"}))])},8722:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toolMode=void 0;const n=o(9774),i=o(4361),r=o(7975),s=o(6453);t.toolMode=({layout:e,currentIndex:t,keyPage:o,touchType:a,actions:c})=>i.div({style:s.toolStyle(e)},[r.keyButton({toolButtonMargin:5,keyPage:o,currentIndex:t,actions:c,width:e.buttons.size.width}),r.toolSpace({flexGrow:100,width:e.buttons.size.width,margin:5,key:"div-space"}),r.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-insert-new-page",key:"btn-insert-new-page",onclick:()=>{c.insertNewPage({index:t+1})}},r.iconContents({description:"add",iconSize:22,iconName:"note_add"})),r.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-duplicate-page",key:"btn-duplicate-page",onclick:()=>{const e=t+1;c.duplicatePage({index:e}),c.openPage({index:e})}},r.iconContents({description:"copy",iconSize:22,iconName:"content_copy"})),r.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-remove-page",key:"btn-remove-page",onclick:()=>c.removePage({index:t})},r.iconContents({description:"remove",iconSize:22,iconName:"remove_circle_outline"})),r.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:a===n.TouchTypes.Piece?"#fff":"#f44336",borderType:a===n.TouchTypes.Piece?"double":void 0,datatest:"btn-piece-mode",key:"btn-piece-mode",onclick:()=>c.changeToDrawPieceMode()},r.iconContents({description:"piece",iconSize:20,iconName:"extension"})),r.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:a===n.TouchTypes.Drawing?"#fff":"#f44336",borderType:a===n.TouchTypes.Drawing?"double":void 0,datatest:"btn-block-mode",key:"btn-block-mode",onclick:()=>c.changeToDrawingMode()},r.iconContents({description:"block",iconSize:22,iconName:"edit"}))])},2308:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.utilsMode=void 0;const n=o(4361),i=o(7975),r=o(6453),s=o(9774);t.utilsMode=({layout:e,touchType:t,actions:o})=>n.div({style:r.toolStyle(e)},[n.div({key:"",style:{},class:""},"utils"),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-mirror",key:"btn-mirror",onclick:()=>{o.convertToMirror()}},i.iconContents({description:"mirror",iconSize:22,iconName:"compare_arrows"})),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-convert-to-gray",key:"btn-convert-to-gray",onclick:()=>{o.convertToGray()}},i.iconContents({description:"to gray",iconSize:19,iconName:"color_lens"})),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:"#333",datatest:"btn-clear-field",key:"btn-clear-field",onclick:()=>{o.clearField()}},i.iconContents({description:"clear",iconSize:22,iconName:"clear"})),i.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:t===s.TouchTypes.Fill?"#fff":"#f44336",borderType:t===s.TouchTypes.Fill?"double":void 0,datatest:"btn-comment-mode",key:"btn-comment-mode",onclick:()=>o.changeToCommentMode()},i.iconContents({marginRight:0,description:"comment",descriptionSize:9,iconSize:19,iconName:"title"})),i.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:t===s.TouchTypes.Fill?"#fff":"#f44336",borderType:t===s.TouchTypes.Fill?"double":void 0,datatest:"btn-fill-mode",key:"btn-fill-mode",onclick:()=>o.changeToFillMode()},i.iconContents({description:"fill",iconSize:20,iconName:"brush"})),i.toolButton({borderWidth:3,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:t===s.TouchTypes.FillRow?"#fff":"#f44336",borderType:t===s.TouchTypes.FillRow?"double":void 0,datatest:"btn-fill-row-mode",key:"btn-fill-row-mode",onclick:()=>o.changeToFillRowMode()},i.iconContents({description:"row",iconSize:24,iconName:"power_input"})),i.toolButton({borderWidth:1,width:e.buttons.size.width,margin:5,backgroundColorClass:"red",textColor:"#fff",borderColor:"#f44336",datatest:"btn-slide-mode",key:"btn-slide-mode",onclick:()=>o.changeToShiftMode()},i.iconContents({description:"slide",iconSize:24,iconName:"swap_vert"}))])},7975:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toolSpace=t.dualSwitchButton=t.switchButton=t.dualButton=t.toolButton=t.keyButton=t.switchIconContents=t.iconContents=t.inferenceButton=t.svgButton=t.rotationButton=t.colorButton=void 0;const n=o(4055),i=o(4361),r=o(9774),s=o(4272);t.colorButton=({layout:e,piece:o,highlight:n,colorize:i,onclick:s})=>{const a=n?3:1,c=r.parsePieceName(o),d=i?`img/${c}.svg`:`img/${c}_classic.svg`;return t.svgButton({src:d,layout:e,highlight:n,borderWidth:a,height:.55*e.buttons.size.height,datatest:`btn-piece-${c.toLowerCase()}`,key:`btn-piece-${c.toLowerCase()}`,onclick:()=>s({piece:o})})},t.rotationButton=({layout:e,rotation:o,highlight:n})=>{const i=void 0!==o?r.parseRotationName(o):"Empty",s=`img/rotation_${i}.svg`;return t.svgButton({src:s,layout:e,highlight:n,height:.85*e.buttons.size.height,borderWidth:0,datatest:`img-rotation-${i.toLowerCase()}`,key:`img-rotation-${i.toLowerCase()}`})},t.svgButton=({src:e,datatest:o,key:r,layout:s,highlight:a,height:c,borderWidth:d,onclick:l})=>{const u=[i.img({src:e,height:`${c}`,style:n.style({margin:"auto"})})];return t.toolButton({borderWidth:d,datatest:o,key:r,onclick:l,width:s.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:a?"#ff5252":"#333"},u)},t.inferenceButton=({layout:e,highlight:o,actions:n})=>{const i=t.iconContents({description:"comp",iconSize:22,iconName:"image_aspect_ratio"}),r=o?3:1;return t.toolButton({borderWidth:r,width:e.buttons.size.width,margin:5,backgroundColorClass:"white",textColor:"#333",borderColor:o?"#ff5252":"#333",datatest:"btn-piece-inference",key:"btn-piece-inference",onclick:()=>n.selectInferencePieceColor()},i)},t.iconContents=({marginRight:e=2,description:t,descriptionSize:o=11,iconSize:r,iconName:a})=>[i.div({style:n.style({marginRight:n.px(e)})},[s.BlockIcon({iconSize:r,key:"icon"},a)])," ",i.span({style:n.style({fontSize:n.px(o),whiteSpace:"nowrap"})},t)],t.switchIconContents=({description:e,iconSize:t,enable:o})=>[i.div({style:n.style({marginRight:n.px(2)})},[s.BlockIcon({iconSize:t,key:"icon"},o?"check_box":"check_box_outline_blank")])," ",i.span({style:n.style({fontSize:n.px(11)})},e)],t.keyButton=({width:e,toolButtonMargin:o,keyPage:n,currentIndex:i,actions:r})=>{const s=n?()=>r.changeToRef({index:i}):()=>r.changeToKey({index:i});return t.switchButton({width:e,borderWidth:1,margin:o,backgroundColorClass:"red",textColor:"#333",borderColor:"#f44336",datatest:"btn-key-page",key:"btn-key-ref-page",onclick:s,enable:n},t.switchIconContents({description:"key",iconSize:18,enable:n}))},t.toolButton=({width:e,backgroundColorClass:t,textColor:o,borderColor:r,borderWidth:s=1,borderType:a="solid",datatest:c,key:d,onclick:l,flexGrow:u,margin:m,enable:p=!0},g)=>i.a({datatest:c,key:d,href:"#",class:(void 0!==l?"waves-effect ":"")+`z-depth-0 btn ${t} ${p?"":"disabled"}`,style:n.style({flexGrow:u,color:p?o:"#9e9e9e",border:p?`${a} ${s}px ${r}`:"solid 1px #9e9e9e",margin:`${n.px(m)} 0px`,padding:n.px(0),width:n.px(e),maxWidth:n.px(e),textAlign:"center",cursor:"pointer"}),onclick:void 0!==l?e=>{l(e),e.stopPropagation(),e.preventDefault()}:void 0},[i.div({style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},g)]),t.dualButton=({width:e,backgroundColorClass:t,textColor:o,borderColor:r,borderWidth:s=1,borderType:a="solid",flexGrow:c,margin:d},l,u)=>{const m=({datatest:e,key:c,contents:d,onclick:l,enable:u=!0,margin:m})=>i.a({datatest:e,key:c,href:"#",class:`waves-effect waves-light z-depth-0 btn ${t} ${u?"":"disabled"}`,style:n.style({margin:m,color:u?o:"#9e9e9e",border:u?`${a} ${s}px ${r}`:"solid 1px #9e9e9e",padding:n.px(0),width:"50%",maxWidth:"50%",textAlign:"center"}),onclick:e=>{l(e),e.stopPropagation(),e.preventDefault()}},[i.div({style:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},d)]);return i.div({style:n.style({flexGrow:c,width:n.px(e),maxWidth:n.px(e),display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",margin:`${n.px(d)} 0px`,padding:n.px(0)})},[m({...l,margin:"0px 2px 0px 0px"}),m({...u,margin:"0px 0px 0px 2px"})])},t.switchButton=({width:e,backgroundColorClass:t,textColor:o,borderColor:r,borderWidth:s=1,datatest:a,key:c,onclick:d,flexGrow:l,margin:u,enable:m},p)=>i.a({key:c,href:"#",class:`waves-effect waves-light z-depth-0 btn ${m?t:"white"}`,datatest:`${a}-${m?"on":"off"}`,style:n.style({flexGrow:l,color:m?"#fff":o,border:m?`solid ${s}px ${r}`:"dashed 1px #333",margin:`${n.px(u)} 0px`,padding:n.px(0),width:n.px(e),maxWidth:n.px(e),textAlign:"center"}),onclick:e=>{d(e),e.stopPropagation(),e.preventDefault()}},[i.div({style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},p)]),t.dualSwitchButton=({width:e,backgroundColorClass:t,textColor:o,borderColor:r,borderWidth:s=1,borderType:a="solid",flexGrow:c,margin:d},l,u)=>{const m=({datatest:e,key:a,contents:c,onclick:d,enable:l=!0,margin:u})=>i.a({datatest:e,key:a,href:"#",class:`waves-effect waves-light z-depth-0 btn ${l?t:"white"}`,style:n.style({margin:u,color:l?"#fff":o,border:l?`solid ${s}px ${r}`:"dashed 1px #333",padding:n.px(0),width:"50%",maxWidth:"50%",textAlign:"center"}),onclick:e=>{d(e),e.stopPropagation(),e.preventDefault()}},[i.div({style:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center"}},c)]);return i.div({style:n.style({flexGrow:c,width:n.px(e),maxWidth:n.px(e),display:"flex",justifyContent:"center",flexDirection:"row",alignItems:"center",margin:`${n.px(d)} 0px`,padding:n.px(0)})},[m({...l,margin:"0px 2px 0px 0px"}),m({...u,margin:"0px 0px 0px 2px"})])},t.toolSpace=({width:e,key:t,flexGrow:o,margin:r})=>i.div({key:t,class:"white",style:n.style({flexGrow:o,color:"#fff",borderWidth:n.px(0),margin:`${n.px(r)} 0px`,padding:n.px(0),width:n.px(e),maxWidth:n.px(e),boxSizing:"border-box",textAlign:"center"})},[])},474:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.navigatorElement=void 0;const n=o(4361),i=o(4055),r=o(4257);t.navigatorElement=({height:e,palette:t,actions:o})=>{if(e)return n.div({className:`${t.baseClass} lighten-5`,onclick:()=>{o.openInPC()},style:i.style({height:i.px(e),display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",fontSize:"16px"})},[n.a({href:"#"},r.i18n.Navigator.OpenInPC())])}},3288:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.view=t.getComment=void 0;const n=o(6314),i=o(4361),r=o(4245),s=o(4264),a=o(9774),c=o(5154),d=o(3149),l=o(3891),u=o(8174),m=o(6136),p=o(2742),g=o(37),h=o(474),f=(e,t,o)=>c.EventCanvas({actions:t,canvas:o.canvas.size,rect:n.resources.konva.event}),y=(e,t,o)=>i.div({key:"field-top",id:"field-top"},[r.KonvaCanvas({actions:t,canvas:o.canvas.size,hyperStage:n.resources.konva.stage}),u.Field({fieldMarginWidth:o.field.bottomBorderWidth,topLeft:o.field.topLeft,blockSize:o.field.blockSize,field:e.field,sentLine:e.sentLine,guideLineColor:e.fumen.guideLineColor}),void 0!==e.hold?d.Box({size:o.hold.size,key:"box-hold",rects:n.resources.konva.hold,topLeft:o.hold.topLeft,piece:a.isMinoPiece(e.hold)?{type:e.hold,color:l.decidePieceColor(e.hold,p.HighlightType.Highlight2,e.fumen.guideLineColor),size:o.hold.boxSize/4-1}:void 0}):void 0,...(void 0!==e.nexts?e.nexts:[]).map(((t,i)=>d.Box({size:o.hold.size,key:`box-next-${i}`,rects:n.resources.konva.nexts[i],topLeft:o.nexts.topLeft(i),piece:a.isMinoPiece(t)?{type:t,color:l.decidePieceColor(t,p.HighlightType.Highlight2,e.fumen.guideLineColor),size:o.nexts.boxSize/4-1}:void 0})))]),v=(e,t,o,n)=>m.ReaderTools({actions:t,height:o,palette:n,currentPage:e.fumen.currentIndex+1,maxPage:e.fumen.maxPage,animationState:e.play.status,pages:`${e.fumen.currentIndex+1} / ${e.fumen.maxPage}`,loop:e.mode.loop});t.getComment=(e,t,o)=>{switch(e.mode.comment){case a.CommentType.PageSlider:return g.page_slider({actions:t,datatest:"range-page-slider",size:{width:.8*o.comment.size.width,height:o.comment.size.height},currentIndex:e.fumen.currentIndex,maxPage:e.fumen.maxPage});default:{const n=e.fumen.currentIndex;return s.comment({currentIndex:n,actions:t,key:`text-comment-reader-${e.comment.changeKey}`,dataTest:"text-comment",id:"text-comment",textColor:e.comment.isChanged?"#fff":"#333",backgroundColorClass:""!==e.comment.text&&e.comment.isChanged?"green darken-1":"white",height:o.comment.size.height,text:e.comment.text,readonly:!0})}}},t.view=(e,o)=>{const r=e.platform===a.Platforms.PC?30:0,s=(({topLeftY:e,width:t,height:o})=>{const n={width:t,height:o-(85+e)},i=Math.min(Math.floor(Math.min(n.height/23.5,n.width/10))-2,n.width/16),r={width:10*(i+1)+1,height:23.5*(i+1)+1+2.4+1},s=Math.max(Math.min(r.width/5*1.15,(n.width-r.width)/2-15),5),a=s/4,c={x:(n.width-r.width)/2,y:(n.height-r.height)/2};return{canvas:{topLeft:{x:0,y:e},size:n},field:{blockSize:i,bottomBorderWidth:2.4,topLeft:c,size:r},hold:{boxSize:s,size:{width:s,height:s},topLeft:{x:c.x-(s+a/2),y:c.y}},nexts:{boxSize:s,size:{width:s,height:s},topLeft:e=>({x:c.x+r.width+a/2,y:c.y+e*(s+a)})},comment:{topLeft:{x:0,y:o-85},size:{width:t,height:35}},tools:{topLeft:{x:0,y:o-50},size:{width:t,height:50}}}})({...e.display,topLeftY:r}),c=l.Palette(a.Screens.Reader),d=()=>n.resources.konva.stage.batchDraw();return i.div({oncreate:d,onupdate:d,key:"view"},[n.resources.konva.stage.isReady?f(0,o,s):void 0,h.navigatorElement({palette:c,actions:o,height:r}),y(e,o,s),i.div({key:"menu-top"},[t.getComment(e,o,s),v(e,o,s.tools.size.height,c)])])}}},t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=e,o.x=e=>{},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0},t=[[5917,736]],n=e=>{},i=(i,r)=>{for(var s,a,[c,d,l,u]=r,m=0,p=[];m<c.length;m++)a=c[m],o.o(e,a)&&e[a]&&p.push(e[a][0]),e[a]=0;for(s in d)o.o(d,s)&&(o.m[s]=d[s]);for(l&&l(o),i&&i(r);p.length;)p.shift()();return u&&t.push.apply(t,u),n()},r=self.webpackChunktetfu_sp=self.webpackChunktetfu_sp||[];function s(){for(var n,i=0;i<t.length;i++){for(var r=t[i],s=!0,a=1;a<r.length;a++){var c=r[a];0!==e[c]&&(s=!1)}s&&(t.splice(i--,1),n=o(o.s=r[0]))}return 0===t.length&&(o.x(),o.x=e=>{}),n}r.forEach(i.bind(null,0)),r.push=i.bind(null,r.push.bind(r));var a=o.x;o.x=()=>(o.x=a||(e=>{}),(n=s)())})(),o.x()})();